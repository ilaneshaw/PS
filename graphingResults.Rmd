---
title: "graphingResults"
author: "Isolde Lane Shaw"
date: "2023-04-28"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
library(sna)
library(rgdal)
library(terra)
library(SpaDES)
library(data.table)
library(ggplot2) 
library(readr)
library(reshape2)
library(scales)
library(tidyr)
library(RColorBrewer)
library(dplyr)
library(forcats)
library(hrbrthemes)
library(viridis)
library(naniar)
library(raster)
library(rasterVis)
library(ggh4x)
library(egg)
library(cowplot)

options(digits=3) #limit number of digits displayed

birdList <- sort(c("BBWA", "BRCR", "CAWA", "DEJU", "OVEN"))
dev.new()
cbPalette <- c( "#56B4E9",  "#0072B2","#009E73", "#F0E442","#E69F00","#D55E00", "#CC79A7", "#999999","black")

```

## LANDSCAPE PLOTS

## summary landscape plot

```{r landscapeSummaryPlots, echo=FALSE}

 #get rasterToMatch
    print("get rasterTomatch from local drive")
    rasterToMatch <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/LCCProducts/LCC05/LCC2005_V1_4a.tif"))
   
    
    #get StudyArea shapefile
    print("get studyArea shapefile from local drive")
    studyArea <- terra::vect(file.path("C:/Users/RALAS6/Documents/Repositories/Data/studyAreaAB/studyAreaAB.shp"))
    
    #postProcess studyArea
    studyArea <- reproducible::postProcess(studyArea,
                                               destinationPath = getwd(),
                                               filename2 = "studyArea", 
                                               useTerra = TRUE,
                                               fun = "terra::vect", #use the function vect
                                               targetCRS = crs(rasterToMatch), #make crs same as rasterToMatch
                                               overwrite = TRUE,
                                               verbose = TRUE)
    
    #crop and mask rasterToMatch
    rasterToMatch <- terra::mask(terra::crop(rasterToMatch, studyArea), studyArea) 
    names(rasterToMatch) <- "rasterToMatch"
    # clearPlot()
    # Plot(sim$rasterToMatch)
    plot(rasterToMatch, colNA = "grey")
    
    # get forest class raster
    print("get forClassRaster from Drive")
    forClassRaster <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/studyAreaAB/vegTypesRas_ABNew_0722.tif"))
    forClassRaster <- postProcess(forClassRaster,
                                      destinationPath = getwd(),
                                     #use the function raster
                                     targetCRS = crs(rasterToMatch),
                                     fun = "terra::rast",
                                     useTerra = TRUE,
                                     #use the specified rasterToMatch to reproject to
                                     rasterToMatch = rasterToMatch,
                                     #studyArea = studyArea,
                                     useCache = getOption("reproducible.useCache", TRUE),
                                     overwrite = TRUE,
                                     verbose = TRUE)
    
    names(forClassRaster) <- c("forClassRaster")
    
    forClassRaster[forClassRaster == 0] <- NA
    
     # clearPlot()
    # Plot(forClassRaster, na.color= "grey")
    plot(forClassRaster, colNA = "grey")
    #get non forest raster
    print("get nonForRaster from Drive")
    nonForRaster <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/studyAreaAB/landClassRaster_AB_202305.tif"))
    nonForRaster <- postProcess(nonForRaster,
                               destinationPath = getwd(),
                               #use the function raster
                               fun = "terra::rast",
                               targetCRS = crs(rasterToMatch),
                               #use the specified rasterToMatch to reproject to
                               rasterToMatch = rasterToMatch,
                               useTerra = TRUE,
                               #studyArea = sim$studyArea,
                               useCache = getOption("reproducible.useCache", TRUE),
                               overwrite = TRUE,
                               verbose = TRUE)
    
    #nonForRaster[nonForRaster == 0] <- NA
    
    names(nonForRaster) <- c("nonForRaster")
    nonForRaster <- terra::mask(nonForRaster, forClassRaster, inverse = TRUE)
    # nonForRaster <- overlay(x = nonForRaster,
    #                         y = forClassRaster,
    #                         fun = function(x, y) {
    #                           x[!is.na(y[])] <- NA
    #                           return(x)
    #                         })
    # 
    # clearPlot()
    # Plot(nonForRaster, na.color= "grey")
    plot(nonForRaster, colNA = "grey")
   
     #get age raster
    print("get ageRaster from Drive")
    ageRaster <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/studyAreaAB/ageRas_ABNew_0722.tif"))
    ageRaster <- postProcess(ageRaster,
                                destinationPath = getwd(),
                                #use the function raster
                                useTerra = TRUE,
                                fun = "terra::rast",
                                #targetCRS = crs(rasterToMatch),
                                #use the specified rasterToMatch to reproject to
                                rasterToMatch = rasterToMatch,
                                #studyArea = studyArea,
                                useCache = getOption("reproducible.useCache", TRUE),
                                overwrite = TRUE,
                                verbose = TRUE)
    
    names(ageRaster) <- c("ageRaster")
    plot(ageRaster, colNA = "grey")

#make landscape raster
  print("make landscapeRaster")
  landscapeRaster <- terra::cover(x = forClassRaster, y = nonForRaster)
  
  names(landscapeRaster) <- c("landscapeRaster")
  
  # clearPlot()
  # Plot(landscapeRaster, na.color= "grey")
 plot(landscapeRaster, colNA = "turquoise")
  #create a raster that gives if an area is forest or not 
  #(0 for non-forest, 1 for forest)
  #This will allow me to have a value in the birdDataset 
  #that says if a cell was forested or not
  print("make FNFRaster")
  #make forest 1
  uniqueValsFR <- terra::unique(forClassRaster,incomparables=FALSE)
  newValsFR <-  as.factor(rep("1", length(uniqueValsFR$forClassRaster))) #make vector that repeats 1 as amy times as there are unique values
  newValsFR <- cbind(uniqueValsFR$forClassRaster, newValsFR)
  newValsFR <- na.omit(newValsFR)
  reclassMatrixFR <- matrix(newValsFR,
                            ncol=2, byrow = FALSE)
  rasterFR <- terra::classify(forClassRaster,
                         reclassMatrixFR)
  #make nonFor 0
  #valsNF <- unique(sim$rasterToMatch) #get vector of all the unique values in the forClassRaster
  uniqueValsNF <- terra::unique(rasterToMatch, incomparables=FALSE)
  newValsNF <-  rep(0, length(uniqueValsNF$rasterToMatch)) #make vector that repeats 0 as amy times as there are unique values
  newValsNF <- cbind(uniqueValsNF$rasterToMatch, newValsNF)
  newValsNF <- na.omit(newValsNF)
  reclassMatrixNF <- matrix(newValsNF,
                            ncol=2, byrow = FALSE)
  rasterNF <- terra::classify(rasterToMatch,
                         reclassMatrixNF)
  
  FNFRaster <- terra::cover(x = rasterFR, y = rasterNF)
  
  names(FNFRaster) <- c("FNFRaster")
  plot(FNFRaster, colNA = "grey")

allLandRasters <- c( forClassRaster, nonForRaster, landscapeRaster, 
                     ageRaster, FNFRaster, rasterToMatch)
    
    
    ## take the values from the rasters and input 
    ## them to a data table called cellValues
    allLandData <- data.table(terra::values(allLandRasters))
    allLandData <- setnames(allLandData, c( "forClassRaster", 
                                          "nonForRaster", 
                                          "landscapeRaster", 
                                          "ageRaster",
                                          "FNFRaster",
                                          "LCC05"))
  allLandData <- unite(allLandData, 
                        uniqueClasses, 
                        c(FNFRaster, 
                          landscapeRaster), 
                        remove=FALSE)
  
    allLandData$FNFRaster <- as.factor(allLandData$FNFRaster)
    allLandData$uniqueClasses <- as.factor(allLandData$uniqueClasses)
     allLandData$LCC05 <- as.factor(allLandData$LCC05)
     
     
     studyArea <- rep("AB", each = nrow(allLandData))
     allLandData <- cbind(allLandData, studyArea) 
    
    #get rid of any rows with NA values
    allLandData <- subset(allLandData, !is.na(landscapeRaster)) 
   #allLandData <- na.omit(allLandData, cols = "ageraster")   
   
 allLandData_AB <- as.data.table(allLandData)
 
 #sort(unique(allLandData$uniqueClasses)) #this shows us that there are nonForestedAreas with no landscapeRaster


 # #check that there are no unwanted overlaps for nonForest raster
 # nonForDat <- na.omit(allLandData, cols = "nonForRaster") 
 # unique(nonForDat$forClassRaster)
 # unique(nonForDat$uniqueClasses)
 #  unique(nonForDat$landscapeRaster)
 #  unique(nonForDat$ageRaster)
 #  unique(nonForDat$FNFRaster)
 #  sort(unique(nonForDat$LCC05) ) 
 #  
 #   #check that there are no unwanted overlaps for nonForest raster
 #  forClasDat <- na.omit(allLandData, cols = "forClassRaster") 
 # unique(forClasDat$nonForRaster)
 # sort(unique(forClasDat$uniqueClasses))
 #  sort(unique(forClasDat$landscapeRaster))
 #  sort(unique(forClasDat$ageRaster))
 #    unique(forClasDat$FNFRaster)
 #    sort(unique(forClasDat$LCC05)) 
  
  
     
 
#get BC data
      #get rasterToMatch
    print("get rasterTomatch from local drive")
    rasterToMatch <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/LCCProducts/LCC05/LCC2005_V1_4a.tif"))
   
    
    #get StudyArea shapefile
    print("get studyArea shapefile from local drive")
    studyArea <- terra::vect(file.path("C:/Users/RALAS6/Documents/Repositories/Data/BCR6-BC/BCR6_BC.shp"))
    
    #postProcess studyArea
    studyArea <- reproducible::postProcess(studyArea,
                                               destinationPath = getwd(),
                                               filename2 = "studyArea", 
                                               useTerra = TRUE,
                                               fun = "terra::vect", #use the function vect
                                               targetCRS = crs(rasterToMatch), #make crs same as rasterToMatch
                                               overwrite = TRUE,
                                               verbose = TRUE)
    
    #crop and mask rasterToMatch
    rasterToMatch <- terra::mask(terra::crop(rasterToMatch, studyArea), studyArea) 
    names(rasterToMatch) <- "rasterToMatch"
    # clearPlot()
    # Plot(sim$rasterToMatch)
    plot(rasterToMatch, colNA = "grey")
    
    # get forest class raster
    print("get forClassRaster from Drive")
    forClassRaster <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/BCR6-BC/vegTypesRas_BC_0722.tif"))
    forClassRaster <- postProcess(forClassRaster,
                                      destinationPath = getwd(),
                                     #use the function raster
                                     targetCRS = crs(rasterToMatch),
                                     fun = "terra::rast",
                                     useTerra = TRUE,
                                     #use the specified rasterToMatch to reproject to
                                     rasterToMatch = rasterToMatch,
                                     #studyArea = studyArea,
                                     useCache = getOption("reproducible.useCache", TRUE),
                                     overwrite = TRUE,
                                     verbose = TRUE)
    
    names(forClassRaster) <- c("forClassRaster")
    
    forClassRaster[forClassRaster == 0] <- NA
    
     # clearPlot()
    # Plot(forClassRaster, na.color= "grey")
    plot(forClassRaster, colNA = "grey")
    #get non forest raster
    print("get nonForRaster from Drive")
    nonForRaster <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/BCR6-BC/landClassRaster_BC_202305.tif"))
    nonForRaster <- postProcess(nonForRaster,
                               destinationPath = getwd(),
                               #use the function raster
                               fun = "terra::rast",
                               targetCRS = crs(rasterToMatch),
                               #use the specified rasterToMatch to reproject to
                               rasterToMatch = rasterToMatch,
                               useTerra = TRUE,
                               #studyArea = sim$studyArea,
                               useCache = getOption("reproducible.useCache", TRUE),
                               overwrite = TRUE,
                               verbose = TRUE)
    
    #nonForRaster[nonForRaster == 0] <- NA
    
    names(nonForRaster) <- c("nonForRaster")
    nonForRaster <- terra::mask(nonForRaster, forClassRaster, inverse = TRUE)
    # nonForRaster <- overlay(x = nonForRaster,
    #                         y = forClassRaster,
    #                         fun = function(x, y) {
    #                           x[!is.na(y[])] <- NA
    #                           return(x)
    #                         })
    # 
    # clearPlot()
    # Plot(nonForRaster, na.color= "grey")
    plot(nonForRaster, colNA = "grey")
   
     #get age raster
    print("get ageRaster from Drive")
    ageRaster <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/BCR6-BC/ageRas_BC_0722.tif"))
    ageRaster <- postProcess(ageRaster,
                                destinationPath = getwd(),
                                #use the function raster
                                useTerra = TRUE,
                                fun = "terra::rast",
                                #targetCRS = crs(rasterToMatch),
                                #use the specified rasterToMatch to reproject to
                                rasterToMatch = rasterToMatch,
                                #studyArea = studyArea,
                                useCache = getOption("reproducible.useCache", TRUE),
                                overwrite = TRUE,
                                verbose = TRUE)
    
    names(ageRaster) <- c("ageRaster")
    plot(ageRaster, colNA = "grey")

#make landscape raster
  print("make landscapeRaster")
  landscapeRaster <- terra::cover(x = forClassRaster, y = nonForRaster)
  
  names(landscapeRaster) <- c("landscapeRaster")
  
  # clearPlot()
  # Plot(landscapeRaster, na.color= "grey")
 plot(landscapeRaster, colNA = "turquoise")
  #create a raster that gives if an area is forest or not 
  #(0 for non-forest, 1 for forest)
  #This will allow me to have a value in the birdDataset 
  #that says if a cell was forested or not
  print("make FNFRaster")
  #make forest 1
  uniqueValsFR <- terra::unique(forClassRaster,incomparables=FALSE)
  newValsFR <-  as.factor(rep("1", length(uniqueValsFR$forClassRaster))) #make vector that repeats 1 as amy times as there are unique values
  newValsFR <- cbind(uniqueValsFR$forClassRaster, newValsFR)
  newValsFR <- na.omit(newValsFR)
  reclassMatrixFR <- matrix(newValsFR,
                            ncol=2, byrow = FALSE)
  rasterFR <- terra::classify(forClassRaster,
                         reclassMatrixFR)
  #make nonFor 0
  #valsNF <- unique(sim$rasterToMatch) #get vector of all the unique values in the forClassRaster
  uniqueValsNF <- terra::unique(rasterToMatch, incomparables=FALSE)
  newValsNF <-  rep(0, length(uniqueValsNF$rasterToMatch)) #make vector that repeats 0 as amy times as there are unique values
  newValsNF <- cbind(uniqueValsNF$rasterToMatch, newValsNF)
  newValsNF <- na.omit(newValsNF)
  reclassMatrixNF <- matrix(newValsNF,
                            ncol=2, byrow = FALSE)
  rasterNF <- terra::classify(rasterToMatch,
                         reclassMatrixNF)
  
  FNFRaster <- terra::cover(x = rasterFR, y = rasterNF)
  
  names(FNFRaster) <- c("FNFRaster")
  plot(FNFRaster, colNA = "grey")

allLandRasters <- c( forClassRaster, nonForRaster, landscapeRaster, 
                     ageRaster, FNFRaster, rasterToMatch)
    
    
    ## take the values from the rasters and input 
    ## them to a data table called cellValues
    allLandData <- data.table(terra::values(allLandRasters))
    allLandData <- setnames(allLandData, c( "forClassRaster", 
                                          "nonForRaster", 
                                          "landscapeRaster", 
                                          "ageRaster",
                                          "FNFRaster",
                                          "LCC05"))
  allLandData <- unite(allLandData, 
                        uniqueClasses, 
                        c(FNFRaster, 
                          landscapeRaster), 
                        remove=FALSE)
  
    allLandData$FNFRaster <- as.factor(allLandData$FNFRaster)
    allLandData$uniqueClasses <- as.factor(allLandData$uniqueClasses)
     allLandData$LCC05 <- as.factor(allLandData$LCC05)
     
     
     studyArea <- rep("BC", each = nrow(allLandData))
     allLandData <- cbind(allLandData, studyArea) 
    
    #get rid of any rows with NA values
    allLandData <- subset(allLandData, !is.na(landscapeRaster)) 
  
 allLandData_BC <- as.data.table(allLandData)
 
 allLandData <- rbind(allLandData_AB,allLandData_BC)
 
 #sort(unique(allLandData$uniqueClasses)) #this shows us that there are nonForestedAreas with no landscapeRaster


 # #check that there are no unwanted overlaps for nonForest raster
 # nonForDat <- na.omit(allLandData, cols = "nonForRaster") 
 # unique(nonForDat$forClassRaster)
 # unique(nonForDat$uniqueClasses)
 #  unique(nonForDat$landscapeRaster)
 #  unique(nonForDat$ageRaster)
 #  unique(nonForDat$FNFRaster)
 #  sort(unique(nonForDat$LCC05) ) 
 #  
 #   #check that there are no unwanted overlaps for nonForest raster
 #  forClasDat <- na.omit(allLandData, cols = "forClassRaster") 
 # unique(forClasDat$nonForRaster)
 # sort(unique(forClasDat$uniqueClasses))
 #  sort(unique(forClasDat$landscapeRaster))
 #  sort(unique(forClasDat$ageRaster))
 #    unique(forClasDat$FNFRaster)
 #    sort(unique(forClasDat$LCC05)) 
  
  
 landDatStats_AB <- allLandData_AB[order(FNFRaster, 
                                         uniqueClasses) 
                                   # order the rows by the land cover class
                                   ][,list(classCount = .N
                                           ),
                                           by = list(FNFRaster, 
                                         uniqueClasses)]
     
     studyArea <- rep("AB", each = nrow(landDatStats_AB))
     landDatStats_AB <-cbind(landDatStats_AB, studyArea) 
     
     landDatStats_BC <- allLandData_BC[order(FNFRaster, 
                                         uniqueClasses) 
                                   # order the rows by the land cover class
                                   ][,list(classCount = .N),
                                           by = list(FNFRaster, 
                                         uniqueClasses)]
     
     studyArea <- rep("BC", each = nrow(landDatStats_BC))
     landDatStats_BC <-cbind(landDatStats_BC, studyArea) 
      
    landDatStats <- rbind(landDatStats_AB, landDatStats_BC)
    landDatStats[ , propArea := classCount/sum(classCount), by = studyArea]
     
###############################################################################################################################################################################################################################################################################################################################################################
    
 ras.labs <- c("Land cover class raster", "Forest class raster")
names(ras.labs) <- c("0", "1")   
    
# make bar chart of different uniqueClasses
    #classDat <- landDatStats[-8,]



    plotClassCounts <- ggplot(data = landDatStats,
                              aes(x = uniqueClasses,
                                  y = propArea,
                                  fill = factor(studyArea, levels=c("BC", "AB")))) +
    geom_bar(stat = "identity",
             position = "dodge",
             width = 0.7) +
      facet_wrap(. ~ FNFRaster, scales = "free", labeller = labeller(FNFRaster= ras.labs))+
    theme_classic() +
    labs(tag = "A") +
      #ggtitle(paste0("Proportional area by cover class")) +
    ylab("Proportion of study area") +
    scale_y_continuous(breaks= pretty_breaks()) +
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
   scale_x_discrete(labels=c("0_0" = "Forest", "0_1" = "Water/Ice", "0_2" = "Wetland", "0_3" = "Anthro/\nExposed", "0_4" = "Grass/\nCrop" , "0_5" = "Shrub", "0_6" = "Bryoid", "1_7" = "White \nSpruce", "1_1" = "Black \nSpruce", "1_2" = "  Black  \nSpruce Wet", "1_6" = "Pine", "1_3" = "Conifer Mix",  "1_5" = "Mixed", "1_4" = "Deciduous"  )) +
    theme(title = element_text(size = 16),
        strip.text.x = element_text(size = 14),
        strip.text.y = element_text(size = 14),
        strip.background = element_rect(
        color="white", fill="white", linewidth =1.5),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(size = 12, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 14),
        axis.title.x = element_blank(),
        legend.title = element_blank(),
        legend.text = element_blank(),
        plot.margin = margin(0,0.5,0,0.1, "cm"),
        legend.position="NULL")
 plotClassCounts   

 
 
 

  

######################################################################################################################################################################################################################################
  
 
 allLandData <- allLandData[allLandData$FNFRaster == 1, ]
 allLandData <- subset(allLandData, !is.na(ageRaster)) 
 allLandData_age <- allLandData

 #assign age class column
 ageGrouping <- 20
 maxAgeClass <- 10
 maxAge <- max(allLandData_age$ageRaster) #get age of oldest cell 
 maxAgeClassAge <- maxAgeClass*ageGrouping 
 
     ifelse(maxAge > maxAgeClassAge, ageRaster <- c(0:maxAge), ageRaster <- c(0:maxAgeClassAge)) #make a vector that counts from 0 to 
  maxAge <-   as.numeric(maxAge)
 noAgeClasses <- maxAge/ageGrouping
 ageClass <- ifelse(noAgeClasses < maxAgeClass, ageClass <- maxAgeClass, ageClass <- noAgeClasses )
    ageClass <- rep(1:ageClass, each = ageGrouping)
    ageClass <- c(1, ageClass)
    if(noAgeClasses > maxAgeClass){
      ageClassDiff <- noAgeClasses - maxAgeClass
      extraClass <- maxAgeClass + (1:ageClassDiff)
      for (x in extraClass) {
        print(x)
        ageClass <- replace(ageClass ,ageClass== x,maxAgeClass)
              } 
    }
 
 ageRefTab <- cbind(ageRaster, ageClass) #creates a lookup table of age to age class
 ageRefTab <- as.data.table(ageRefTab)
 ageRefTab$ageRaster <- as.character(ageRefTab$ageRaster)
 ageRefTab$ageClass <- as.character(ageRefTab$ageClass)
 #allLandData$ageClass = allLandData$ageRaster #replicate age data in new column
 
 #replace ages with ageClass in ageClass column
 # new <- allLandData
 # new[] <- lapply(allLandData, function(x) ageRefTab$ageClass[match(x, ageRefTab$ageRaster)])
# ageClassTab[] <- ageRefTab$ageClass[match(unlist(allLandData), ageRefTab$ageRaster)]

 library(dplyr)
library(tidyr)
 allLandData_age$ageRaster <- as.character(allLandData_age$ageRaster)
 #storeDat <- allLandData
allLandData_age %>% pivot_longer(cols = "ageRaster")
 allLandData_age <-  allLandData_age %>% left_join(ageRefTab, by = "ageRaster") 
   #allLandData %>% pivot_wider(key = ageRaster, value = ageClass)
  allLandData_age
 
 landDatStats_age <- allLandData_age[order(studyArea,
                                        ageClass)
                                  # order the rows by the land cover class
                                  ][,list(classCount = .N
                                          ),
                                          by = list(studyArea, ageClass
                                        )]

   landDatStats_age[ , propArea := classCount/sum(classCount), by = studyArea]
   AB9 <- list("AB", 9, 0, 0)
   AB10 <- list("AB", 10, 0, 0)
   landDatStats_age <- rbind(landDatStats_age, AB9)
   landDatStats_age <- rbind(landDatStats_age, AB10)
 
 # landDatStats_AB <- allLandData_AB[order(FNFRaster, 
  #                                        uniqueClasses) 
  #                                  # order the rows by the land cover class
  #                                  ][,list(classCount = .N
  #                                          ),
  #                                          by = list(FNFRaster, 
  #                                        uniqueClasses)]
  #    
  #    studyArea <- rep("AB", each = nrow(landDatStats_AB))
  #    landDatStats_AB <-cbind(landDatStats_AB, studyArea) 
  #    
  #    landDatStats_BC <- allLandData_BC[order(FNFRaster, 
  #                                        uniqueClasses) 
  #                                  # order the rows by the land cover class
  #                                  ][,list(classCount = .N),
  #                                          by = list(FNFRaster, 
  #                                        uniqueClasses)]
  #    
  #    studyArea <- rep("BC", each = nrow(landDatStats_BC))
  #    landDatStats_BC <-cbind(landDatStats_BC, studyArea) 
  #     
  #   landDatStats <- rbind(landDatStats_AB, landDatStats_BC)
  #   landDatStats[ , propArea := classCount/sum(classCount), by = studyArea]
 
# make histogram of ages
  #landDatNoNAs <- na.omit(allLandData)
#   class.labs <- c("Forested", "Water/Ice", "Wetland", "Anthro/Exposed", "Grass/Crop", "Shrub", "Bryoid", "Black Spruce", "Black Spruce Wet", "Conifer Mix", "Deciduous", "Mixed", "Pine", "White Spruce")
# names(class.labs) <- c("0_0", "0_1", "0_2", "0_3", "0_4", "0_5", "0_6", "1_1", "1_2", "1_3", "1_4", "1_5", "1_6", "1_7")


  # ggplot(aes(x = hwy)) +
  # #geom_histogram(aes(y = after_stat(count / sum(count))),binwidth=6) +
  # scale_y_continuous(labels = scales::percent)

  #ageHistDat <- na.omit(allLandData, cols = "forClassRaster")
 ageDistribution <- ggplot(data = landDatStats_age,
                              aes(x = ageClass,
                                  y = propArea,
                                  fill = factor(studyArea, levels=c("BC", "AB")))) +
    geom_bar(stat = "identity",
             position = "dodge",
             width = 0.7) +
   labs(tag = "B") +
    #ggtitle(paste0("Forest age class structure")) +
    xlab("Age (yrs)") +
    ylab("Proportion of study area") +
    theme_classic()+
   scale_x_discrete(labels=c("1" = "0-20","2" = "21-40","3" = "41-60","4"= "61-80","5"= "81-100","6"= "101-120","7"= "121-140", "8" = "141-160","9" = "161-180", "10" = "181+"),
                   limits=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10")) +
    scale_y_continuous(breaks= pretty_breaks()) +
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
     theme(title = element_text(size = 16),
        strip.text.x = element_text(size = 14),
        strip.text.y = element_text(size = 14),
        strip.background = element_rect(
        color="white", fill="white", linewidth =1.5),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(size = 12, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 14),
        axis.title.x = element_text(size = 12),
        legend.title = element_blank(),
        legend.text = element_blank(),
        plot.margin = margin(0,0,0.5,0.3, "cm"),
        legend.position="NULL")
  ageDistribution
 
# # examine 0 class
#   class0 <- allLandData[nonForRaster == "0"]
#   class0 <- droplevels(class0)
#   list(unique(class0$LCC05))
#   
#   
#  class0Stats <- class0[order(LCC05)  
#                        ][,list(classCount = .N), 
#                                                                                       by = list(LCC05)]
#     class0Stats
#  class0Stats$LCC05 <- as.factor(class0Stats$LCC05)
#  
#     plot0Class <- ggplot(data = class0Stats,
#                               aes(x = LCC05,
#                                   y = classCount)) +
#     geom_bar(stat = "identity",
#              width = 0.7, 
#              fill = 'goldenrod2') +
#     theme_classic() +
#     ggtitle(paste0("BC - LCC05 class distribution for remaining forest class cells in non-forest raster")) +
#     xlab("LCC05 class") +
#     ylab("Pixel count") 
#   plot0Class
    
    
#     
#   #examine areas that have a 0 for FNFRaster, but NA for landscapeRaster (are in the study area, but have no data from forest raster or non-forest raster)
#   class0_NA <- allLandData[uniqueClasses == "0_NA"]
#   class0_NA <- droplevels(class0_NA)
#   list(unique(class0_NA$LCC05))
#  
#   class0_NAStats <- class0_NA[order(LCC05)  
#                        ][,list(classCount = .N), 
#                                                                                       by = list(LCC05)]
#     class0_NAStats
#  class0_NAStats$LCC05 <- as.factor(class0_NAStats$LCC05)
#  
#     plot0_NAClass <- ggplot(data = class0_NAStats,
#                               aes(x = LCC05,
#                                   y = classCount)) +
#     geom_bar(stat = "identity",
#              width = 0.7, 
#              fill = 'goldenrod2') +
#     theme_classic() +
#     ggtitle(paste0("BC - LCC05 class distribution for areas with 0_NA class (no data from forest or non forest rasters)")) +
#     xlab("LCC05 class") +
#     ylab("Pixel count") 
#   plot0_NAClass
#     
#   plot(landscapeRaster, colNA="red") #it is possible to see a few pixels dotted across the landscapeRaster that do not have values
#   
# 
#   
# #find out LCC05 classes within each of our defined classes
# class.labs <- c("Forested", "Water/Ice", "Wetland", "Anthro/Exposed", "Grass/Crop", "Shrub", "Bryoid", "Black Spruce", "Black Spruce Wet", "Conifer Mix", "Deciduous", "Mixed", "Pine", "White Spruce")
# names(class.labs) <- c("0_0", "0_1", "0_2", "0_3", "0_4", "0_5", "0_6", "1_1", "1_2", "1_3", "1_4", "1_5", "1_6", "1_7")
# 
# raster.labs <- c("Not in forest raster", "In forest raster")
# names(raster.labs) <- c("0", "1")
# 
#   histLCC05ByClass   <-  gghistogram(
#     stat = "count",
#   allLandData, x = "LCC05", 
#   fill = "FNFRaster"
#   ) +
#     facet_nested( FNFRaster + uniqueClasses ~. ,
#                  labeller = labeller(uniqueClasses = class.labs, FNFRaster = raster.labs),
#                   scales = 'free_y'
#                  ) +
#      ggtitle(paste0("AB - Histogram of LCC05 Value by Class")) +
#      xlab("LCC05 value") +
#      ylab("Number of pixels") +
#     theme(title = element_text(size = 16),
#         strip.text.x = element_text(size = 14),
#         strip.text.y = element_text(size = 14),
#         strip.background = element_rect(
#         color="white", fill="white", linewidth =1.5),
#         axis.text.y = element_text(size = 12),
#         axis.text.x = element_text(size = 12, angle = 45, hjust = 1),
#         axis.title.y = element_text(size = 14),
#         axis.title.x = element_blank(),
#         legend.title = element_blank(),
#         legend.text = element_text(size = 12),
#         legend.position="bottom",
#         plot.margin = margin(0.5,0.5,0.5,0.5, "cm"))
#  histLCC05ByClass 

 
 ######################################################################################################################################################################################################################################
 
 
 # make bar chart of mean age by uniqueClasses


     ageStats <- allLandData[order(studyArea, 
                                         uniqueClasses) 
                                   # order the rows by the land cover class
                                   ][,list(classCount = .N, 
                                           meanAge = mean(ageRaster)),
                                           by = list(studyArea, 
                                         uniqueClasses)]
     
    
 #ageStats <- na.omit(classDat, cols = "meanAge")    
 plotMeanAgeByClass <- ggplot(data = ageStats,
                              aes(x = uniqueClasses,
                                  y = meanAge,
                                  fill = factor(studyArea, levels=c("BC", "AB")))) +
    geom_bar(stat = "identity",
             position = "dodge",
             width = 0.7) +
    theme_classic() +
   # ggtitle(paste0("Mean age by forest class")) +
   labs(tag = "C") +
    xlab("Forest class") +
    ylab("Mean age") +
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
   scale_x_discrete(labels=c("1_1" = "Black \nSpruce", "1_2" = "Black \nSpruce Wet", "1_3" = "Conifer Mix", "1_4" = "Deciduous", "1_5" = "Mixed", "1_6" = "Pine", "1_7" = "White \nSpruce")) +
  theme(title = element_text(size = 16),
        strip.text.x = element_text(size = 14),
        strip.text.y = element_text(size = 14),
        strip.background = element_rect(
        color="white", fill="white", linewidth =1.5),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(size = 12, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 14),
        axis.title.x = element_blank(),
        legend.title = element_blank(),
        legend.text = element_text(size = 12),
        plot.margin = margin(0,0.5,0,0, "cm"),
        legend.position="bottom")
  plotMeanAgeByClass 
  
######################################################################################################################################################################################################################################

# put landscape plots together

lay <- rbind(c(1,1), c(2,3))

landscapeSummary <- gridExtra::grid.arrange(plotClassCounts,  
                                            ageDistribution, 
                                            plotMeanAgeByClass, 
                                            layout_matrix = lay
                                               )

  
  #    
  # allMatrixPlot <- ggarrange( plotClassCounts +
  #                             theme(title = element_blank())
  #                          ,
  #                          ageDistribution +
  #                             theme(title = element_blank())
  #                          ,
  #                          plotMeanAgeByClass+
  #                             theme(title = element_blank()),
  #                            widths = c(2, 1, 1), 
  #                            #heights = c(1, 1, 1),
  #                          #layout_matrix = lay,
  #                           nrow = 2,
  #                           #ncol = 2,
  #                          labels = c("A", "B", "C"),
  #                          label.args = list(gp=gpar(font=4, fontsize = 16), x=unit(1,"line"), hjust=1)
  #                           ) 
  
  
#   library(gridExtra)
# grid.arrange(bp, dp, vp, sc, ncol=2, nrow =2)
```

##landscape rasters maps

```{r landscapeRasterMaps, echo=FALSE}

# GET AB LANDSCAPE RASTERS

 #get rasterToMatch
    print("get rasterTomatch from local drive")
    AB_rasterToMatch <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/LCCProducts/LCC05/LCC2005_V1_4a.tif"))
   
    
    #get StudyArea shapefile
    print("get studyArea shapefile from local drive")
    AB_studyArea <- terra::vect(file.path("C:/Users/RALAS6/Documents/Repositories/Data/studyAreaAB/studyAreaAB.shp"))
    
    #postProcess studyArea
    AB_studyArea <- reproducible::postProcess(AB_studyArea,
                                               destinationPath = getwd(),
                                               filename2 = "AB_studyArea", 
                                               useTerra = TRUE,
                                               fun = "terra::vect", #use the function vect
                                               targetCRS = crs(AB_rasterToMatch), #make crs same as rasterToMatch
                                               overwrite = TRUE,
                                               verbose = TRUE)
    
    #crop and mask rasterToMatch
    AB_rasterToMatch <- terra::mask(terra::crop(AB_rasterToMatch, AB_studyArea), AB_studyArea) 
    names(AB_rasterToMatch) <- "AB_rasterToMatch"
    # clearPlot()
    # Plot(sim$rasterToMatch)
    #plot(AB_rasterToMatch, colNA = "grey")
    
    # get forest class raster
    print("get forClassRaster from Drive")
    AB_forClassRaster <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/studyAreaAB/vegTypesRas_ABNew_0722.tif"))
    AB_forClassRaster <- postProcess(AB_forClassRaster,
                                      destinationPath = getwd(),
                                     #use the function raster
                                     targetCRS = crs(AB_rasterToMatch),
                                     fun = "terra::rast",
                                     useTerra = TRUE,
                                     #use the specified rasterToMatch to reproject to
                                     rasterToMatch = AB_rasterToMatch,
                                     #studyArea = studyArea,
                                     useCache = getOption("reproducible.useCache", TRUE),
                                     overwrite = TRUE,
                                     verbose = TRUE)
    
    names(AB_forClassRaster) <- c("AB_forClassRaster")
    
    AB_forClassRaster[AB_forClassRaster == 0] <- NA
    
     # clearPlot()
    # Plot(forClassRaster, na.color= "grey")
    #plot(AB_forClassRaster, colNA = "grey")
    #get non forest raster
    print("get nonForRaster from Drive")
    AB_nonForRaster <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/studyAreaAB/landClassRaster_AB_202305.tif"))
    AB_nonForRaster <- postProcess(AB_nonForRaster,
                               destinationPath = getwd(),
                               #use the function raster
                               fun = "terra::rast",
                               targetCRS = crs(AB_rasterToMatch),
                               #use the specified rasterToMatch to reproject to
                               rasterToMatch = AB_rasterToMatch,
                               useTerra = TRUE,
                               #studyArea = sim$studyArea,
                               useCache = getOption("reproducible.useCache", TRUE),
                               overwrite = TRUE,
                               verbose = TRUE)
    
    #nonForRaster[nonForRaster == 0] <- NA
    
    names(AB_nonForRaster) <- c("AB_nonForRaster")
    AB_nonForRaster <- terra::mask(AB_nonForRaster, AB_forClassRaster, inverse = TRUE)
    # nonForRaster <- overlay(x = nonForRaster,
    #                         y = forClassRaster,
    #                         fun = function(x, y) {
    #                           x[!is.na(y[])] <- NA
    #                           return(x)
    #                         })
    # 
    # clearPlot()
    # Plot(nonForRaster, na.color= "grey")
    #plot(AB_nonForRaster, colNA = "grey")
   
     #get age raster
    print("get ageRaster from Drive")
    AB_ageRaster <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/studyAreaAB/ageRas_ABNew_0722.tif"))
    AB_ageRaster <- postProcess(AB_ageRaster,
                                destinationPath = getwd(),
                                #use the function raster
                                useTerra = TRUE,
                                fun = "terra::rast",
                                #targetCRS = crs(rasterToMatch),
                                #use the specified rasterToMatch to reproject to
                                rasterToMatch = AB_rasterToMatch,
                                #studyArea = studyArea,
                                useCache = getOption("reproducible.useCache", TRUE),
                                overwrite = TRUE,
                                verbose = TRUE)
    
    names(AB_ageRaster) <- c("AB_ageRaster")
    #plot(AB_ageRaster, colNA = "grey")

#make landscape raster
  print("make landscapeRaster")
  AB_landscapeRaster <- terra::cover(x = AB_forClassRaster, y = AB_nonForRaster)
  
  names(AB_landscapeRaster) <- c("AB_landscapeRaster")
  
  # clearPlot()
  # Plot(landscapeRaster, na.color= "grey")
# plot(AB_landscapeRaster, colNA = "turquoise")
  #create a raster that gives if an area is forest or not 
  #(0 for non-forest, 1 for forest)
  #This will allow me to have a value in the birdDataset 
  #that says if a cell was forested or not
  print("make FNFRaster")
  #make forest 1
  uniqueValsFR <- terra::unique(AB_forClassRaster,incomparables=FALSE)
  newValsFR <-  as.factor(rep("1", length(uniqueValsFR$AB_forClassRaster))) #make vector that repeats 1 as amy times as there are unique values
  newValsFR <- cbind(uniqueValsFR$AB_forClassRaster, newValsFR)
  newValsFR <- na.omit(newValsFR)
  reclassMatrixFR <- matrix(newValsFR,
                            ncol=2, byrow = FALSE)
  rasterFR <- terra::classify(AB_forClassRaster,
                         reclassMatrixFR)
  #make nonFor 0
  #valsNF <- unique(sim$rasterToMatch) #get vector of all the unique values in the forClassRaster
  uniqueValsNF <- terra::unique(AB_rasterToMatch, incomparables=FALSE)
  newValsNF <-  rep(0, length(uniqueValsNF$AB_rasterToMatch)) #make vector that repeats 0 as amy times as there are unique values
  newValsNF <- cbind(uniqueValsNF$AB_rasterToMatch, newValsNF)
  newValsNF <- na.omit(newValsNF)
  reclassMatrixNF <- matrix(newValsNF,
                            ncol=2, byrow = FALSE)
  rasterNF <- terra::classify(AB_rasterToMatch,
                         reclassMatrixNF)
  
  AB_FNFRaster <- terra::cover(x = rasterFR, y = rasterNF)
  
  names(AB_FNFRaster) <- c("AB_FNFRaster")
  #plot(AB_FNFRaster, colNA = "grey")

  
  
  
  
  #GET BC LANDSCAPE RASTERS
  
   #get rasterToMatch
    print("get rasterTomatch from local drive")
    BC_rasterToMatch <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/LCCProducts/LCC05/LCC2005_V1_4a.tif"))
   
    
    #get StudyArea shapefile
    print("get studyArea shapefile from local drive")
    BC_studyArea <- terra::vect(file.path("C:/Users/RALAS6/Documents/Repositories/Data/BCR6-BC/BCR6_BC.shp"))
    
    #postProcess studyArea
    BC_studyArea <- reproducible::postProcess(BC_studyArea,
                                               destinationPath = getwd(),
                                               filename2 = "BC_studyArea", 
                                               useTerra = TRUE,
                                               fun = "terra::vect", #use the function vect
                                               targetCRS = crs(BC_rasterToMatch), #make crs same as rasterToMatch
                                               overwrite = TRUE,
                                               verbose = TRUE)
    
    #crop and mask rasterToMatch
    BC_rasterToMatch <- terra::mask(terra::crop(BC_rasterToMatch, BC_studyArea), BC_studyArea) 
    names(BC_rasterToMatch) <- "BC_rasterToMatch"
    # clearPlot()
    # Plot(sim$rasterToMatch)
    #plot(BC_rasterToMatch, colNA = "grey")
    
    # get forest class raster
    print("get forClassRaster from Drive")
    BC_forClassRaster <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/BCR6-BC/vegTypesRas_BC_0722.tif"))
    BC_forClassRaster <- postProcess(BC_forClassRaster,
                                      destinationPath = getwd(),
                                     #use the function raster
                                     targetCRS = crs(BC_rasterToMatch),
                                     fun = "terra::rast",
                                     useTerra = TRUE,
                                     #use the specified rasterToMatch to reproject to
                                     rasterToMatch = BC_rasterToMatch,
                                     #studyArea = studyArea,
                                     useCache = getOption("reproducible.useCache", TRUE),
                                     overwrite = TRUE,
                                     verbose = TRUE)
    
    names(BC_forClassRaster) <- c("BC_forClassRaster")
    
    BC_forClassRaster[BC_forClassRaster == 0] <- NA
    
     # clearPlot()
    # Plot(forClassRaster, na.color= "grey")
    #plot(BC_forClassRaster, colNA = "grey")
    #get non forest raster
    print("get nonForRaster from Drive")
    BC_nonForRaster <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/BCR6-BC/landClassRaster_BC_202305.tif"))
    BC_nonForRaster <- postProcess(BC_nonForRaster,
                               destinationPath = getwd(),
                               #use the function raster
                               fun = "terra::rast",
                               targetCRS = crs(BC_rasterToMatch),
                               #use the specified rasterToMatch to reproject to
                               rasterToMatch = BC_rasterToMatch,
                               useTerra = TRUE,
                               #studyArea = sim$studyArea,
                               useCache = getOption("reproducible.useCache", TRUE),
                               overwrite = TRUE,
                               verbose = TRUE)
    
    #nonForRaster[nonForRaster == 0] <- NA
    
    names(BC_nonForRaster) <- c("BC_nonForRaster")
    BC_nonForRaster <- terra::mask(BC_nonForRaster, BC_forClassRaster, inverse = TRUE)
    # nonForRaster <- overlay(x = nonForRaster,
    #                         y = forClassRaster,
    #                         fun = function(x, y) {
    #                           x[!is.na(y[])] <- NA
    #                           return(x)
    #                         })
    # 
    # clearPlot()
    # Plot(nonForRaster, na.color= "grey")
    #plot(BC_nonForRaster, colNA = "grey")
   
     #get age raster
    print("get ageRaster from Drive")
    BC_ageRaster <- terra::rast(file.path("C:/Users/RALAS6/Documents/Repositories/Data/BCR6-BC/ageRas_BC_0722.tif"))
    BC_ageRaster <- postProcess(BC_ageRaster,
                                destinationPath = getwd(),
                                #use the function raster
                                useTerra = TRUE,
                                fun = "terra::rast",
                                #targetCRS = crs(rasterToMatch),
                                #use the specified rasterToMatch to reproject to
                                rasterToMatch = BC_rasterToMatch,
                                #studyArea = studyArea,
                                useCache = getOption("reproducible.useCache", TRUE),
                                overwrite = TRUE,
                                verbose = TRUE)
    
    names(BC_ageRaster) <- c("BC_ageRaster")
    #plot(BC_ageRaster, colNA = "grey")

#make landscape raster
  print("make landscapeRaster")
  BC_landscapeRaster <- terra::cover(x = BC_forClassRaster, y = BC_nonForRaster)
  
  names(BC_landscapeRaster) <- c("BC_landscapeRaster")
  
  # clearPlot()
  # Plot(landscapeRaster, na.color= "grey")
 #plot(BC_landscapeRaster, colNA = "turquoise")
  #create a raster that gives if an area is forest or not 
  #(0 for non-forest, 1 for forest)
  #This will allow me to have a value in the birdDataset 
  #that says if a cell was forested or not
  print("make FNFRaster")
  #make forest 1
  uniqueValsFR <- terra::unique(BC_forClassRaster,incomparables=FALSE)
  newValsFR <-  as.factor(rep("1", length(uniqueValsFR$BC_forClassRaster))) #make vector that repeats 1 as amy times as there are unique values
  newValsFR <- cbind(uniqueValsFR$BC_forClassRaster, newValsFR)
  newValsFR <- na.omit(newValsFR)
  reclassMatrixFR <- matrix(newValsFR,
                            ncol=2, byrow = FALSE)
  rasterFR <- terra::classify(BC_forClassRaster,
                         reclassMatrixFR)
  #make nonFor 0
  #valsNF <- unique(sim$rasterToMatch) #get vector of all the unique values in the forClassRaster
  uniqueValsNF <- terra::unique(BC_rasterToMatch, incomparables=FALSE)
  newValsNF <-  rep(0, length(uniqueValsNF$BC_rasterToMatch)) #make vector that repeats 0 as amy times as there are unique values
  newValsNF <- cbind(uniqueValsNF$BC_rasterToMatch, newValsNF)
  newValsNF <- na.omit(newValsNF)
  reclassMatrixNF <- matrix(newValsNF,
                            ncol=2, byrow = FALSE)
  rasterNF <- terra::classify(BC_rasterToMatch,
                         reclassMatrixNF)
  
  BC_FNFRaster <- terra::cover(x = rasterFR, y = rasterNF)
  
  names(BC_FNFRaster) <- c("BC_FNFRaster")
  #plot(BC_FNFRaster, colNA = "grey")
  
  


#forClassRaster
#plot(forClassRaster, colNA="grey70")
# customizing the legend
plot(BC_forClassRaster, main = 'British Columbia forest class raster', legend = FALSE, col = cbPalette, colNA="white", axes=FALSE, box=FALSE)
legend("bottom", legend = c( "Black Spruce", "Black Spruce Wet", "Conifer Mix", "Deciduous", "Mixed", "Pine", "White Spruce"), fill = cbPalette)

plot(AB_forClassRaster, main = 'Alberta forest class raster', legend = FALSE, col = cbPalette, colNA="white", axes=FALSE, box=FALSE)
legend("bottomright", legend = c( "Black Spruce", "Black Spruce Wet", "Conifer Mix", "Deciduous", "Mixed", "Pine", "White Spruce"), fill = cbPalette)

#nonForRaster
#plot(nonForRaster,colNA="grey70")
# customizing the legend
nf.legend <- legend("right", legend = c("Forested", "Water/Ice", "Wetland", "Anthro/Exposed Land", "Grass/Cropland", "Shrub", "Bryoid"), fill = cbPalette)
plot(BC_nonForRaster, main = 'British Columbia land class raster', legend = FALSE, colNA="white", col = cbPalette, axes=FALSE, box=FALSE)
plot(AB_nonForRaster, main = 'Alberta land class raster', legend = nf.legend, col = cbPalette, colNA="white", axes=FALSE, box=FALSE)



#ageRaster
min_ = min(min(terra::unique(AB_ageRaster)), min(terra::unique(BC_ageRaster)))
max_ = max(max(terra::unique(AB_ageRaster)), max(terra::unique(BC_ageRaster)))
r.range = c(min_, max_)

plot(BC_ageRaster, main = 'British Columbia age raster', colNA="white", range = r.range, col = cbPalette, axes=FALSE, box=FALSE) 
plot(AB_ageRaster, main = 'Alberta age raster', colNA="white", range = r.range, col = cbPalette, axes=FALSE, box = FALSE)  
  

# AB_rasters <- c(BC_nonForRaster, BC_forClassRaster, BC_ageRaster)
# 
# plot(AB_rasters, col = cbPalette, colNA="white", axes=FALSE, box = FALSE)
# op <- par(mfrow = c(2,1),
#   oma = c(2,4,0,0) + 0.1,
#   mar = c(5,0,1,1) + 0.1)
# plot( xras, col=rev( rainbow( 99, start=0,end=1 ) ), breaks=seq(min_,max_,length.out=100), legend = FALSE,  axes = FALSE )
# plot( yras, col=rev( rainbow( 99, start=0,end=1 ) ), breaks=seq(min_,max_,length.out=100), legend = FALSE, axes = FALSE )
# 
# plot(xras, col=rev( rainbow( 99, start=0,end=1 ) ), horizontal=TRUE, `breaks=seq(min_,max_,length.out=100), legend.only=TRUE, legend.shrink = 1, legend.width = 3, axis.args = list(at=seq(r.range[1], r.range[2], abs(r.range[1]-r.range[2])/4), labels = round(seq(r.range[1], r.range[2], abs(r.range[1]-r.range[2])/4),2),cex.axis=1), legend.args= list(text='Precipitation (XXX)', side=1, font=3, line = 2, cex=1))
# 
# levelplot(stack(AB_ageRaster, BC_ageRaster), col.regions = rev(rainbow(99, start=0, end=1)), colorkey = list(space = "bottom"))


```





## PLOT MAIN 1D PREDICTION RESULTS

## (single dataset) make plot of 1D mean density by cover class 


```{r meanDensity1D, echo=FALSE}

#make plot of 1D mean density by cover class
birdPreds1D <- lapply(birdList, FUN= function(bird){
  birdPreds1D <- as.data.frame(read_csv(paste("Results/PS results AB 20 yr age classes boot ras/",bird, " _birdPreds1D.csv", sep = "")))
  birdPreds1D$uniqueClasses <- as.character(birdPreds1D$uniqueClasses)
  birdPreds1D$forestedStatus <- as.character(birdPreds1D$forestedStatus)
  return(birdPreds1D)
})
names(birdPreds1D) <- birdList

#make dataframe of birds you want to include
birdPreds1DSingleFrame <- rbind(birdPreds1D$BBWA, birdPreds1D$BRCR, birdPreds1D$CAWA, birdPreds1D$OVEN)

#Make plot
plotMeanBirdDensity <- ggplot(data = birdPreds1DSingleFrame,
                              aes(x = uniqueClasses,
                                  y = meanBirdDensity,
                                  fill = forestedStatus)) +
  facet_wrap(~ birdSp, ncol = 1, scales= 'free_y') +
  geom_bar(stat = "identity",
           width = 0.7) +
  geom_errorbar(aes(ymin = meanBirdDensity - seBirdDensity, ymax = meanBirdDensity + seBirdDensity),
                width = .20) +
  theme_classic() +
  ggtitle("Mean density by cover class") +
  xlab("Cover Class") +
  ylab("Mean Density") +
  scale_y_continuous(breaks= pretty_breaks()) +
  scale_x_discrete(labels=c("0_0" = "Forest", "0_1" = "Water/Ice", "0_2" = "Wetland", "0_3" = "Anthro/Exposed", "0_4" = "Grass/Crop" , "0_5" = "Shrub", "0_6" = "Bryoid", "1_1" = "Black Spruce", "1_2" = "Black Spruce Wet", "1_3" = "Conifer Mix", "1_4" = "Deciduous", "1_5" = "Mixed", "1_6" = "Pine", "1_7" = "White Spruce")) +
  scale_fill_manual(values=c("#56B4E9", "#009E73"),
                    labels = c("Non-forest raster", "Forest raster")) +
  theme(title = element_text(size = 14),
        strip.text.x = element_text(
          size = 12),
        legend.title = element_blank(),
        legend.position="bottom",
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.title = element_text(size = 12))

plotMeanBirdDensity
#jpeg(paste(plotsLocation, "plotMeanBirdDensity1D.jpg", sep = ""))

```


## (two datasets) make plot of 1D mean density by cover class 


```{r meanDensity1D_2datasets, echo=FALSE}
dev.new()
#make plot of 1D mean density by cover class
birdPreds1D <- lapply(birdList, FUN= function(bird){
 
   birdPreds1D <- as.data.frame(read_csv(paste("Results/PS results AB 20 yr age classes boot ras/",bird, " _birdPreds1D.csv", sep = "")))
  birdPreds1D$uniqueClasses <- as.character(birdPreds1D$uniqueClasses)
  birdPreds1D$forestedStatus <- as.character(birdPreds1D$forestedStatus)
  return(birdPreds1D)
})
names(birdPreds1D) <- birdList

#make dataframe of birds you want to include
birdPreds1DSingleFrame_1 <- rbind(birdPreds1D$BBWA, birdPreds1D$BRCR, birdPreds1D$CAWA, birdPreds1D$DEJU, birdPreds1D$OVEN)
dataset <- rep("AB", each = nrow(birdPreds1DSingleFrame_1))
birdPreds1DSingleFrame_1 <- cbind(birdPreds1DSingleFrame_1, dataset)

#make plot of 1D mean density by cover class
birdPreds1D <- lapply(birdList, FUN= function(bird){
  birdPreds1D <- as.data.frame(read_csv(paste("Results/PS results BC 20 yr age classes boot ras/",bird, " _birdPreds1D.csv", sep = "")))
  birdPreds1D$uniqueClasses <- as.character(birdPreds1D$uniqueClasses)
  birdPreds1D$forestedStatus <- as.character(birdPreds1D$forestedStatus)
  return(birdPreds1D)
})
names(birdPreds1D) <- birdList

#make dataframe of birds you want to include
birdPreds1DSingleFrame_2 <- rbind(birdPreds1D$BBWA, birdPreds1D$BRCR, birdPreds1D$CAWA, birdPreds1D$DEJU, birdPreds1D$OVEN)
dataset <- rep("BC", each = nrow(birdPreds1DSingleFrame_2))
birdPreds1DSingleFrame_2 <- cbind(birdPreds1DSingleFrame_2, dataset)

birdPreds1DSingleFrame <- rbind(birdPreds1DSingleFrame_1, birdPreds1DSingleFrame_2)

#define labels
sp.labs <- c("Bay-breasted \nWarbler", "Brown \nCreeper", "Canada \nWarbler", "Dark-eyed \nJunco", "Ovenbird")
names(sp.labs) <- c("BBWA", "BRCR", "CAWA", "DEJU", "OVEN")

ras.labs <- c("Land cover class raster", "Forest class raster")
names(ras.labs) <- c("0", "1")

#Make plot

plotMeanBirdDensity <- ggplot(data = birdPreds1DSingleFrame,
                              aes(x = uniqueClasses,
                                  y = meanBirdDensity,
                                  fill = factor(dataset, levels=c("BC", "AB")))) +
  facet_grid(birdSp  ~ forestedStatus, scales= 'free',
             labeller = labeller(birdSp = sp.labs,forestedStatus = ras.labs)
  ) +
  geom_bar(stat = "identity",
           position = "dodge",
           width = 0.7) +
  # geom_errorbar(aes(ymin = meanBirdDensity - seBirdDensity, ymax = meanBirdDensity + seBirdDensity),
  #               width = .20) +
  theme_classic() +
  ggtitle("Predicted bird density (males/ha) by class") +
  #xlab("Cover Class") +
  ylab("Mean density (males/ha)") +
  labs(fill = "Study area") +
  scale_y_continuous(breaks= pretty_breaks()) +
  scale_x_discrete(labels=c("0_0" = "Unclassified forest", "0_1" = "Water/Ice", "0_2" = "Wetland", "0_3" = "Anthro/Exposed", "0_4" = "Grass/Crop" , "0_5" = "Shrub", "0_6" = "Bryoid", "1_1" = "Black spruce", "1_2" = "Black spruce wet", "1_3" = "Conifer Mix", "1_4" = "Deciduous", "1_5" = "Mixed", "1_6" = "Pine", "1_7" = "White spruce")) +
  scale_fill_manual(values=c("#009E73","#56B4E9"),
                    labels = c( "British Columbia", "Alberta")) +
  theme(title = element_text(size = 14),
        strip.text = element_text(
          size = 14),
        legend.title = element_text(size = 14),
        legend.text = element_text(size = 12),
        legend.position="bottom",
        strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(size = 12, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 14),
        axis.title.x = element_blank())

plotMeanBirdDensity
#jpeg(paste(plotsLocation, "plotMeanBirdDensity1D.jpg", sep = ""))

```


## (single dataset) make plot of median bird density for 1D bins 

```{r medianDensity1D, echo=FALSE}

#make plot of median bird density for 1D bins
birdPreds1D <- lapply(birdList, FUN= function(bird){
  birdPreds1D <- as.data.frame(read_csv(paste("Results/PS results AB 20 yr age classes boot ras/",bird, " _birdPreds1D.csv", sep = "")))
  birdPreds1D$uniqueClasses <- as.character(birdPreds1D$uniqueClasses)
  birdPreds1D$forestedStatus <- as.character(birdPreds1D$forestedStatus)
  return(birdPreds1D)
})
names(birdPreds1D) <- birdList

#make dataframe of birds you want to include
birdPreds1DSingleFrame <- rbind(birdPreds1D$BBWA, birdPreds1D$BRCR, birdPreds1D$CAWA, birdPreds1D$OVEN)

#Make plot
plotMedianBirdDensity <- ggplot(data = birdPreds1DSingleFrame,
                              aes(x = uniqueClasses,
                                  y = medianBirdDensity,
                                  fill = forestedStatus)) +
  facet_wrap(~ birdSp, ncol = 1, scales= 'free_y') +
  geom_bar(stat = "identity",
           width = 0.7) +
  geom_errorbar(aes(ymin = medianBirdDensity - seBirdDensity, ymax = medianBirdDensity + seBirdDensity),
                width = .20) +
  theme_classic() +
  ggtitle("Median density by cover class") +
  xlab("Cover Class") +
  ylab("Median Density") +
  scale_y_continuous(breaks= pretty_breaks()) +
  scale_x_discrete(labels=c("0_0" = "Forest", "0_1" = "Water/Ice", "0_2" = "Wetland", "0_3" = "Anthro/Exposed", "0_4" = "Grass/Crop" , "0_5" = "Shrub", "0_6" = "Bryoid", "1_1" = "Black Spruce", "1_2" = "Black Spruce Wet", "1_3" = "Conifer Mix", "1_4" = "Deciduous", "1_5" = "Mixed", "1_6" = "Pine", "1_7" = "White Spruce")) +
  scale_fill_manual(values=c("#56B4E9", "#009E73"),
                    labels = c("Non-forest raster", "Forest raster")) +
  theme(title = element_text(size = 14),
        strip.text.x = element_text(
          size = 12),
        legend.title = element_blank(),
        legend.position="bottom",
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.title = element_text(size = 12))
        

plotMedianBirdDensity
#jpeg(paste(plotsLocation, "plotMedianBirdDensity1D.jpg", sep = ""))


```



## (two datasets) make plot of 1D median density by cover class 


```{r medianDensity1D_2datasets, echo=FALSE}

#make plot of 1D mean density by cover class
birdPreds1D <- lapply(birdList, FUN= function(bird){
  birdPreds1D <- as.data.frame(read_csv(paste("Results/PS results AB 20 yr age classes boot ras/",bird, " _birdPreds1D.csv", sep = "")))
  birdPreds1D$uniqueClasses <- as.character(birdPreds1D$uniqueClasses)
  birdPreds1D$forestedStatus <- as.character(birdPreds1D$forestedStatus)
  return(birdPreds1D)
})
names(birdPreds1D) <- birdList

#make dataframe of birds you want to include
birdPreds1DSingleFrame_1 <- rbind(birdPreds1D$BBWA, birdPreds1D$BRCR, birdPreds1D$CAWA, birdPreds1D$DEJU, birdPreds1D$OVEN)
dataset <- rep("AB", each = nrow(birdPreds1DSingleFrame_1))
birdPreds1DSingleFrame_1 <- cbind(birdPreds1DSingleFrame_1, dataset)

#make plot of 1D mean density by cover class
birdPreds1D <- lapply(birdList, FUN= function(bird){
  birdPreds1D <- as.data.frame(read_csv(paste("Results/PS results BC 20 yr age classes boot ras/",bird, " _birdPreds1D.csv", sep = "")))
  birdPreds1D$uniqueClasses <- as.character(birdPreds1D$uniqueClasses)
  birdPreds1D$forestedStatus <- as.character(birdPreds1D$forestedStatus)
  return(birdPreds1D)
})
names(birdPreds1D) <- birdList

#make dataframe of birds you want to include
birdPreds1DSingleFrame_2 <- rbind(birdPreds1D$BBWA, birdPreds1D$BRCR, birdPreds1D$CAWA, birdPreds1D$DEJU, birdPreds1D$OVEN)
dataset <- rep("BC", each = nrow(birdPreds1DSingleFrame_2))
birdPreds1DSingleFrame_2 <- cbind(birdPreds1DSingleFrame_2, dataset)

birdPreds1DSingleFrame <- rbind(birdPreds1DSingleFrame_1, birdPreds1DSingleFrame_2)

#define labels
sp.labs <- c("Bay-breasted Warbler", "Brown Creeper", "Canada Warbler",  "Dark-eyed Junco","Ovenbird")
names(sp.labs) <- c("BBWA", "BRCR", "CAWA", "DEJU", "OVEN")

#Make plot

plotMedianBirdDensity <- ggplot(data = birdPreds1DSingleFrame,
                              aes(x = uniqueClasses,
                                  y = medianBirdDensity,
                                  fill = factor(dataset, levels=c("BC", "AB")))) +
  facet_grid(birdSp  ~ forestedStatus, scales= 'free',
             labeller = labeller(birdSp = sp.labs,forestedStatus = ras.labs)
  ) +
  geom_bar(stat = "identity",
           position = "dodge",
           width = 0.7) +
  # geom_errorbar(aes(ymin = meanBirdDensity - seBirdDensity, ymax = meanBirdDensity + seBirdDensity),
  #               width = .20) +
  theme_classic() +
  ggtitle("Median bird density (males/ha) by cover class, \nfor two study areas") +
  #xlab("Cover Class") +
  ylab("Median density (males/ha)") +
  labs(fill = "Study area location") +
  scale_y_continuous(breaks= pretty_breaks()) +
  scale_x_discrete(labels=c("0_0" = "Unclassified forest", "0_1" = "Water/Ice", "0_2" = "Wetland", "0_3" = "Anthro/Exposed", "0_4" = "Grass/Crop" , "0_5" = "Shrub", "0_6" = "Bryoid", "1_1" = "Black spruce", "1_2" = "Black spruce wet", "1_3" = "Conifer Mix", "1_4" = "Deciduous", "1_5" = "Mixed", "1_6" = "Pine", "1_7" = "White spruce")) +
  scale_fill_manual(values=c("#009E73","#56B4E9"),
                    labels = c( "British Columbia", "Alberta")) +
  theme(title = element_text(size = 14),
        strip.text = element_text(
          size = 14),
        legend.title = element_text(size = 14),
        legend.text = element_text(size = 12),
        legend.position="bottom",
        strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(size = 12, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 14),
        axis.title.x = element_blank())

plotMedianBirdDensity
#jpeg(paste(plotsLocation, "plotMeanBirdDensity1D.jpg", sep = ""))

```



## PLOT MAIN 2D PREDICTION RESULTS

## (single dataset) make plots of 2D bird density predictions 

#For AB study area, using 20 yr age classes

```{r plotBirdMatriciesAB20, echo=FALSE}


#make plot of 2D bird density predictions

#get matricies
birdMatricies <- lapply(birdList, FUN= function(bird){
  birdMatrix <- as.data.frame(read_csv(paste("Results/PS results AB 20 yr age classes boot ras/",bird, " _matrix.csv", sep = "")))
  return(birdMatrix)
})
names(birdMatricies) <- birdList


matrixAsTables <- lapply(X = birdList, FUN = function(bird){
 
  matrix <-  eval(parse(text=paste("birdMatricies$", bird, sep = "")))
  matrix <- matrix[2:ncol(matrix)]
  matrix <- data.matrix(matrix)
  tab <- melt(matrix)
  colnames(tab) <- c( "forClass","ageClass", "birdDensityPred")
  birdSp <- rep(paste(bird), nrow(tab))
  tab <- cbind(tab, birdSp = birdSp)
  tab$ageClass <- as.character(tab$ageClass)
  tab$forClass <- as.character(tab$forClass)
  tab$birdSp <- as.character(tab$birdSp)
  tab$birdDensityPred <- as.numeric(tab$birdDensityPred)
  print(tab)
  
  return(tab)
})

names(matrixAsTables) <- birdList

#make dataframe of birds you want to include
dataFrameForGraph <- rbind(matrixAsTables$BBWA,  matrixAsTables$BRCR, matrixAsTables$CAWA, matrixAsTables$DEJU, matrixAsTables$OVEN)

#define facet labels for birds
sp.labs <- c("Bay-breasted \nWarbler", "Brown \nCreeper", "Canada \nWarbler", "Dark-eyed \nJunco", "Ovenbird")
names(sp.labs) <- c("BBWA", "BRCR", "CAWA", "DEJU", "OVEN")

# New facet label names for forest classes
class.labs <- c("Black \nSpruce", "Black \nSpruce Wet", "Conifer \nMix", "Deciduous", "Mixed", "Pine", "White \nSpruce")
names(class.labs) <- c("1", "2", "3", "4", "5", "6", "7")



AB20_plotMeanBirdDensity2D <- ggplot(data = dataFrameForGraph,
                                aes(fill= ageClass, y= birdDensityPred, x= ageClass)) +
  geom_bar(position = "dodge", stat = "identity") +
  facet_grid( birdSp ~ forClass,
              labeller = labeller(forClass = class.labs, birdSp = sp.labs),
              scales="free") +
  theme_classic() +
  ggtitle("Predicted density (males/ha) by forest class and age (20-yr age classes), \nfor Alberta study area") +
  xlab("Age (yrs)")  +
  scale_x_discrete(labels=c("1" = "0-20","2" = "","3" = "41-60","4"= "","5"= "81-100","6"= "","7"= "", "8" = "141-160","9" = "", "10" = "181+"),
                   limits=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10")) +
   scale_fill_manual(values=c("#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9")) +
  ylab("Bird density (males/ha)") +
  scale_y_continuous(breaks= pretty_breaks()) +
  theme(title = element_text(size = 14),
        strip.text.x = element_text(
          size = 13),
        strip.text.y = element_text(
          size = 13),
        legend.position="NULL",
        strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(size = 12, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 14),
        axis.title.x = element_text(size = 14),
        plot.margin = margin(0.5,0.5,0.5,0.5, "cm"))

facet_bounds <- read.table(header=TRUE,
text=
"birdSp ymin ymax     breaks  xmin  xmax
BBWA       0     0.08   0.02     1    10
BRCR       0     0.25   0.05     1    10
CAWA       0     0.025  0.005    1    10
DEJU       0     0.3    0.05     1    10
OVEN       0     0.25    0.05     1    10",
stringsAsFactors=FALSE)

ff <- with(facet_bounds,
           data.frame(birdDensityPred=c(ymin,ymax),
                      ageClass=c(xmin,xmax),
                      birdSp=c(birdSp,birdSp)))
ff$ageClass <- as.character(ff$ageClass)

AB20_plotMeanBirdDensity2D + geom_point(data=ff,x=NA)

#plotMeanBirdDensity2D
#jpeg("plotMeanBirdDensity2D.jpg")

```

#For AB study area, using 10 yr age classes

```{r plotBirdMatriciesAB10, echo=FALSE}

#make plot of 2D bird density predictions

#get matricies
birdMatricies <- lapply(birdList, FUN= function(bird){
  birdMatrix <- as.data.frame(read_csv(paste("Results/PS results AB 10 yr age classes boot ras/",bird, " _matrix.csv", sep = "")))
  return(birdMatrix)
})
names(birdMatricies) <- birdList

matrixAsTables <- lapply(X = birdList, FUN = function(bird){
 
  matrix <-  eval(parse(text=paste("birdMatricies$", bird, sep = "")))
  matrix <- matrix[2:ncol(matrix)]
  matrix <- data.matrix(matrix)
  tab <- melt(matrix)
  colnames(tab) <- c( "forClass","ageClass", "birdDensityPred")
  birdSp <- rep(paste(bird), nrow(tab))
  tab <- cbind(tab, birdSp = birdSp)
  tab$ageClass <- as.character(tab$ageClass)
  tab$forClass <- as.character(tab$forClass)
  tab$birdSp <- as.character(tab$birdSp)
  tab$birdDensityPred <- as.numeric(tab$birdDensityPred)
  print(tab)
  
  return(tab)
})

names(matrixAsTables) <- birdList

#make dataframe of birds you want to include
dataFrameForGraph <- rbind(matrixAsTables$BBWA,  matrixAsTables$BCCH, matrixAsTables$BRCR, matrixAsTables$CAWA, matrixAsTables$DEJU, matrixAsTables$OVEN)


#define labels
sp.labs <- c("Bay-breasted \nWarbler", "Black-capped \nChickadee", "Brown \nCreeper", "Canada \nWarbler", "Dark-eyed \nJunco", "Ovenbird")
names(sp.labs) <- c("BBWA", "BCCH", "BRCR", "CAWA", "DEJU", "OVEN")

# New facet label names for forest classes
class.labs <- c("Black \nSpruce", "Black \nSpruce Wet", "Conifer \nMix", "Deciduous", "Mixed", "Pine", "White \nSpruce")
names(class.labs) <- c("1", "2", "3", "4", "5", "6", "7")

plotMeanBirdDensity2D <- ggplot(data = dataFrameForGraph,
                                aes(fill= ageClass, y= birdDensityPred, x= ageClass)) +
  geom_bar(position = "dodge", stat = "identity") +
  facet_grid( birdSp ~ forClass,
              labeller = labeller(forClass = class.labs, birdSp = sp.labs),
              scales="free_y") +
  theme_classic() +
  ggtitle("Predicted bird density by forest type and age for the Alberta study area, \nusing 10-year age classes") +
  xlab("Age (yrs)")  +
  scale_x_discrete(labels=c("1" = "0-10","2" = "","3" = "","4"= "","5"= "41-50","6"= "","7"= "", "8" = "","9" = "", "10" = "91-100", "11" = "","12"= "","13" = "","14" = "","15"= "141-150","16"= "","17"= "", "18" = "", "19" = "181+"),
                   limits=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19")) +
   scale_fill_manual(values=c("#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9","#56B4E9")) +
  ylab("Predicted bird density (males/ha)") +
  scale_y_continuous(breaks= pretty_breaks()) +
  theme(title = element_text(size = 14),
        strip.text.x = element_text(
          size = 14),
        strip.text.y = element_text(
          size = 14),
        legend.position="NULL",
        strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(size = 12, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 14),
        axis.title.x = element_text(size = 14))

plotMeanBirdDensity2D
#jpeg("plotMeanBirdDensity2D.jpg")

```


#For BC study area, using 20 yr age classes

```{r plotBirdMatriciesBC20, echo=FALSE}

dev.new()
#make plot of 2D bird density predictions

#get matricies
birdMatricies <- lapply(birdList, FUN= function(bird){
  birdMatrix <- as.data.frame(read_csv(paste("Results/PS results BC 20 yr age classes boot ras/",bird, " _matrix.csv", sep = "")))
  return(birdMatrix)
})
names(birdMatricies) <- birdList

matrixAsTables <- lapply(X = birdList, FUN = function(bird){
 
  matrix <-  eval(parse(text=paste("birdMatricies$", bird, sep = "")))
  matrix <- matrix[2:ncol(matrix)]
  matrix <- data.matrix(matrix)
  tab <- melt(matrix)
  colnames(tab) <- c( "forClass","ageClass", "birdDensityPred")
  birdSp <- rep(paste(bird), nrow(tab))
  tab <- cbind(tab, birdSp = birdSp)
  tab$ageClass <- as.character(tab$ageClass)
  tab$forClass <- as.character(tab$forClass)
  tab$birdSp <- as.character(tab$birdSp)
  tab$birdDensityPred <- as.numeric(tab$birdDensityPred)
  print(tab)
  
  return(tab)
})

names(matrixAsTables) <- birdList

#make dataframe of birds you want to include
dataFrameForGraph <- rbind(matrixAsTables$BBWA,  matrixAsTables$BRCR, matrixAsTables$CAWA, matrixAsTables$DEJU, matrixAsTables$OVEN)

#define labels
#define labels
sp.labs <- c("Bay-breasted \nWarbler", "Brown \nCreeper", "Canada \nWarbler", "Dark-eyed \nJunco", "Ovenbird")
names(sp.labs) <- c("BBWA", "BRCR", "CAWA", "DEJU", "OVEN")

# New facet label names for forest classes
class.labs <- c("Black \nSpruce", "Black \nSpruce Wet", "Conifer \nMix", "Deciduous", "Mixed", "Pine", "White \nSpruce")
names(class.labs) <- c("1", "2", "3", "4", "5", "6", "7")

BC20_plotMeanBirdDensity2D <- ggplot(data = dataFrameForGraph,
                                aes(fill= ageClass, y= birdDensityPred, x= ageClass)) +
  geom_bar(position = "dodge", stat = "identity") +
  facet_grid( birdSp ~ forClass,
              labeller = labeller(forClass = class.labs, birdSp = sp.labs),
              scales="free") +
  theme_classic() +
  ggtitle("Predicted density (males/ha) by forest class and age (20-yr age classes), \nfor British Columbia study area") +
  xlab("Age (yrs)")  +
  scale_x_discrete(labels=c("1" = "0-20","2" = "","3" = "41-60","4"= "","5"= "81-100","6"= "","7"= "", "8" = "141-160","9" = "", "10" = "181+"),
                   limits=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10")) +
   scale_fill_manual(values=c("#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73")) +
  ylab("Bird density (males/ha)") +
  scale_y_continuous(breaks= pretty_breaks()) +
  theme(title = element_text(size = 14),
        strip.text.x = element_text(
          size = 13),
        strip.text.y = element_text(
          size = 13),
        legend.position="NULL",
        strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(size = 12, angle = 45, hjust = 1),
        axis.title.y = element_text(size = 14),
        axis.title.x = element_text(size = 14),
        plot.margin = margin(0.5,0.5,0.5,0.5, "cm"))

facet_bounds <- read.table(header=TRUE,
text=
"birdSp ymin ymax     breaks  xmin  xmax
BBWA       0     0.08   0.02     1    10
BRCR       0     0.25   0.05     1    10
CAWA       0     0.025  0.005    1    10
DEJU       0     0.3    0.05     1    10
OVEN       0     0.25    0.05     1    10",
stringsAsFactors=FALSE)

ff <- with(facet_bounds,
           data.frame(birdDensityPred=c(ymin,ymax),
                      ageClass=c(xmin,xmax),
                      birdSp=c(birdSp,birdSp)))
ff$ageClass <- as.character(ff$ageClass)

BC20_plotMeanBirdDensity2D + geom_point(data=ff,x=NA)


#plotMeanBirdDensity2D
#jpeg("plotMeanBirdDensity2D.jpg")

```

#For BC study area, using 10 yr age classes

```{r plotBirdMatriciesBC10, echo=FALSE}

#make plot of 2D bird density predictions

#get matricies
birdMatricies <- lapply(birdList, FUN= function(bird){
  birdMatrix <- as.data.frame(read_csv(paste("Results/PS results BC 10 yr age classes boot ras/",bird, " _matrix.csv", sep = "")))
  return(birdMatrix)
})
names(birdMatricies) <- birdList

matrixAsTables <- lapply(X = birdList, FUN = function(bird){
 
  matrix <-  eval(parse(text=paste("birdMatricies$", bird, sep = "")))
  matrix <- matrix[2:ncol(matrix)]
  matrix <- data.matrix(matrix)
  tab <- melt(matrix)
  colnames(tab) <- c( "forClass","ageClass", "birdDensityPred")
  birdSp <- rep(paste(bird), nrow(tab))
  tab <- cbind(tab, birdSp = birdSp)
  tab$ageClass <- as.character(tab$ageClass)
  tab$forClass <- as.character(tab$forClass)
  tab$birdSp <- as.character(tab$birdSp)
  tab$birdDensityPred <- as.numeric(tab$birdDensityPred)
  print(tab)
  
  return(tab)
})

names(matrixAsTables) <- birdList

#make dataframe of birds you want to include
dataFrameForGraph <- rbind(matrixAsTables$BBWA,  matrixAsTables$BCCH, matrixAsTables$BRCR, matrixAsTables$CAWA, matrixAsTables$DEJU, matrixAsTables$OVEN)

#define labels
#define labels
sp.labs <- c("Bay-breasted \nWarbler", "Black-capped \nChickadee", "Brown \nCreeper", "Canada \nWarbler", "Dark-eyed \nJunco", "Ovenbird")
names(sp.labs) <- c("BBWA", "BCCH", "BRCR", "CAWA", "DEJU", "OVEN")

# New facet label names for forest classes
class.labs <- c("Black \nSpruce", "Black \nSpruce Wet", "Conifer \nMix", "Deciduous", "Mixed", "Pine", "White \nSpruce")
names(class.labs) <- c("1", "2", "3", "4", "5", "6", "7")

plotMeanBirdDensity2D <- ggplot(data = dataFrameForGraph,
                                aes(fill= ageClass, y= birdDensityPred, x= ageClass)) +
  geom_bar(position = "dodge", stat = "identity") +
  facet_grid( birdSp ~ forClass,
              labeller = labeller(forClass = class.labs, birdSp = sp.labs),
              scales="free_y") +
  theme_classic() +
  ggtitle("Predicted bird density by forest type and age for the British Columbia study area, \nusing 10-year age classes") +
  xlab("Age (yrs)")  +
  scale_x_discrete(labels=c("1" = "0-10","2" = "","3" = "","4"= "","5"= "41-50","6"= "","7"= "", "8" = "","9" = "", "10" = "91-100", "11" = "","12"= "","13" = "","14" = "","15"= "141-150","16"= "","17"= "", "18" = "", "19" = "181+"),
                   limits=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19")) +
   scale_fill_manual(values=c("#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73","#009E73")) +
  ylab("Predicted bird density (males/ha)") +
  scale_y_continuous(breaks= pretty_breaks()) +
  theme(title = element_text(size = 14),
        strip.text.x = element_text(
          size = 14),
        strip.text.y = element_text(
          size = 14),
        legend.position="NULL",
        strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(size = 12, angle = 35, hjust = 1),
        axis.title.y = element_text(size = 14),
        axis.title.x = element_text(size = 14))

plotMeanBirdDensity2D
#jpeg("plotMeanBirdDensity2D.jpg")

```


## (two datasets) plot bird matricies

```{r twoDatasetsPlotBirdMatricies, echo=FALSE}

#make plot of 2D bird density predictions

#get matricies
birdMatricies <- lapply(birdList, FUN= function(bird){
  birdMatrix <- as.data.frame(read_csv(paste("Results/PS results AB 20 yr age classes boot ras/",bird, " _matrix.csv", sep = "")))
  return(birdMatrix)
})
names(birdMatricies) <- birdList


AB20_matrixAsTables <- lapply(X = birdList, FUN = function(bird){
 
  matrix <-  eval(parse(text=paste("birdMatricies$", bird, sep = "")))
  matrix <- matrix[2:ncol(matrix)]
  matrix <- data.matrix(matrix)
  tab <- melt(matrix)
  colnames(tab) <- c( "forClass","ageClass", "birdDensityPred")
  birdSp <- rep(paste(bird), nrow(tab))
  tab <- cbind(tab, birdSp = birdSp)
  tab$ageClass <- as.character(tab$ageClass)
  tab$forClass <- as.character(tab$forClass)
  tab$birdSp <- as.character(tab$birdSp)
  tab$birdDensityPred <- as.numeric(tab$birdDensityPred)
  print(tab)
  
  return(tab)
})

names(AB20_matrixAsTables) <- birdList


#make plot of 2D bird density predictions

#get matricies
birdMatricies <- lapply(birdList, FUN= function(bird){
  birdMatrix <- as.data.frame(read_csv(paste("Results/PS results BC 20 yr age classes boot ras/",bird, " _matrix.csv", sep = "")))
  return(birdMatrix)
})
names(birdMatricies) <- birdList

BC20_matrixAsTables <- lapply(X = birdList, FUN = function(bird){
 
  matrix <-  eval(parse(text=paste("birdMatricies$", bird, sep = "")))
  matrix <- matrix[2:ncol(matrix)]
  matrix <- data.matrix(matrix)
  tab <- melt(matrix)
  colnames(tab) <- c( "forClass","ageClass", "birdDensityPred")
  birdSp <- rep(paste(bird), nrow(tab))
  tab <- cbind(tab, birdSp = birdSp)
  tab$ageClass <- as.character(tab$ageClass)
  tab$forClass <- as.character(tab$forClass)
  tab$birdSp <- as.character(tab$birdSp)
  tab$birdDensityPred <- as.numeric(tab$birdDensityPred)
  print(tab)
  
  return(tab)
})

names(BC20_matrixAsTables) <- birdList



# make a plot for each sp

# New facet label names for species, forest classes, and study areas
sp.labs <- c("Bay-breasted \nWarbler", "Brown \nCreeper", "Canada \nWarbler", "Dark-eyed \nJunco", "Ovenbird \n")
names(sp.labs) <- c("BBWA", "BRCR", "CAWA", "DEJU", "OVEN")

class.labs <- c("Black \nSpruce", "Black \nSpruce Wet", "Conifer \nMix", "Deciduous", "Mixed", "Pine", "White \nSpruce")
names(class.labs) <- c("1", "2", "3", "4", "5", "6", "7")

sa.labs <- c("British Columbia", "Alberta")
names(sa.labs) <- c("BC", "AB")

#do not see facet labels for study area
strips <- strip_nested(
  text_y = list(element_blank(), element_text()),
  background_y = list(element_blank(), element_rect()), 
  by_layer_y = TRUE,
  bleed = TRUE
)

plotMeanBirdDensity2D <- lapply(X = birdList, FUN = function(bird){
 
  print(bird)
  
  BC20_matrixAsTables <- eval(parse(text=paste("BC20_matrixAsTables$", bird, sep = "")))
  AB20_matrixAsTables <- eval(parse(text=paste("AB20_matrixAsTables$", bird, sep = "")))
  
  
  #make dataframe of birds you want to include
dataset <- rep("BC", each = nrow(BC20_matrixAsTables))
BC20_matrixAsTables <- cbind(BC20_matrixAsTables, dataset)
dataset <- rep("AB", each = nrow(AB20_matrixAsTables))
AB20_matrixAsTables <- cbind(AB20_matrixAsTables, dataset)

tab <- rbind(BC20_matrixAsTables,  AB20_matrixAsTables)
  
# make ggplot
plotMeanBirdDensity2D <- ggplot(data = tab,
                                aes(fill= dataset, y= birdDensityPred, x= ageClass)) +
  geom_bar(position = "dodge", stat = "identity") +
  facet_nested( factor(dataset, levels = c("BC", "AB")) + birdSp ~ forClass,
              labeller = labeller(forClass = class.labs, birdSp = sp.labs),
              strip = strips,
              nest_line = element_line(linetype = 2)) +
  theme_classic() +
  ggtitle("Predicted bird density (males/ha) by forest class and age") +
  xlab("Forest age (yrs)")  +
  scale_x_discrete(labels=c("1" = "0-20","2" = "","3" = "41-60","4"= "","5"= "81-100","6"= "","7"= "", "8" = "141-160","9" = "", "10" = "181+"),
                   limits=c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10")) +
 scale_fill_manual(values=c("#009E73","#56B4E9"), labels=c("BC" = "British Columbia", "AB" = "Alberta" ),limits = c("BC", "AB")) +
   ylab("Density (males/ha)") +
  scale_y_continuous(breaks= pretty_breaks()) +
  theme(title = element_text(size = 16),
        strip.text.x = element_text(
          size = 14),
        strip.text.y = element_text(
          size = 14),
        legend.position="bottom",
        legend.title = element_blank(),
        legend.text = element_text(size = 14),
        strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(size = 12, angle = 35, hjust = 1),
        axis.title.y = element_text(size = 14),
        axis.line.y = element_line(linewidth = 1),
        axis.title.x = element_text(size = 14))

  return(plotMeanBirdDensity2D)
})

names(plotMeanBirdDensity2D) <- birdList


allMatrixPlot <- ggarrange(plotMeanBirdDensity2D$BBWA +
                             theme(axis.text.x = element_blank(),
                                   #axis.ticks.x = element_blank(),
                                   axis.title.x = element_blank(),
                                   axis.title.y = element_blank(),
                                   legend.position= "none")
                           ,
                           plotMeanBirdDensity2D$BRCR +
                             theme(axis.text.x = element_blank(),
                                   #axis.ticks.x = element_blank(),
                                   axis.title.x = element_blank(),
                                   axis.title.y = element_blank(),
                                   strip.text.x = element_blank(),
                                   legend.position= "none",
                                   title = element_blank()
                                   )
                           ,
                           plotMeanBirdDensity2D$CAWA +
                             theme(axis.text.x = element_blank(),
                                   #axis.ticks.x = element_blank(),
                                   axis.title.x = element_blank(),
                                   strip.text.x = element_blank(),
                                   title = element_blank(),
                                   legend.position= "none")
                           ,
                           plotMeanBirdDensity2D$DEJU +
                             theme(axis.text.x = element_blank(),
                                   #axis.ticks.x = element_blank(),
                                   axis.title.x = element_blank(),
                                   axis.title.y = element_blank(),
                                   strip.text.x = element_blank(),
                                   title = element_blank(),
                                   legend.position = "none")
                           ,
                          plotMeanBirdDensity2D$OVEN+
                             theme(axis.title.y = element_blank(),
                                   title = element_blank(),
                                   strip.text.x = element_blank()), 
                         
                           ncol = 1
                            )
dev.new()
allMatrixPlot

```

## DENSITY PLOTS

## (single dataset) Examine the 1D data using a density plot 

Creates a density plot for a single species, selected from the birdDatasets, for each class. 

```{r densityPlot1D, echo=FALSE}

#get birdDatasets
birdDatasets <- lapply(birdList, FUN= function(bird){
  birdDatasets <- as.data.frame(read_csv(paste("Results/PS results AB 20 yr age classes boot ras/",bird, " _fullDataset.csv", sep = "")))
  birdDatasets$uniqueClasses <- as.character(birdDatasets$uniqueClasses)
  birdDatasets$forestedStatus <- as.character(birdDatasets$forestedStatus)
  birdDatasets$landForClass <- as.character(birdDatasets$landForClass)
  birdDatasets$birdSp <- as.character(birdDatasets$birdSp)
  birdDatasets$age <- as.integer(birdDatasets$age)
  return(birdDatasets)
})
names(birdDatasets) <- birdList


class.labs <- c("Forested", "Water/Ice", "Wetland", "Anthro/Exposed", "Grass/Crop", "Shrub", "Bryoid", "Black Spruce", "Black Spruce Wet", "Conifer Mix", "Deciduous", "Mixed", "Pine", "White Spruce")
names(class.labs) <- c("0_0", "0_1", "0_2", "0_3", "0_4", "0_5", "0_6", "1_1", "1_2", "1_3", "1_4", "1_5", "1_6", "1_7")


  densityPlot <-  ggplot(birdDatasets$OVEN, aes(x=birdDensity, fill=factor(forestedStatus))) +
  geom_density() +
    facet_wrap( ~ uniqueClasses, 
    labeller = labeller(uniqueClasses = class.labs), scales = "free") +
    theme_classic() +
  ggtitle("Density plots for OVEN") +
    xlab("Predicted bird density")  +
    scale_x_continuous(breaks= pretty_breaks()) +
    ylab("Density of value") +
    scale_y_continuous(breaks= pretty_breaks()) +
    scale_fill_manual(values=c("#56B4E9", "#009E73"), labels = c("Non-forest raster", "Forest raster")) +
    theme(title = element_text(size = 14),
          strip.text.x = element_text(
        size = 12),
        legend.title = element_blank(),
          legend.position="bottom",
          axis.text.x = element_text(size = 10),
          axis.title = element_text(size = 12))

   densityPlot
#jpeg("densityPlot_OVEN.jpg")

```

## (two datasets) Examine the 1D data using a density plot 

Creates a density plot for a single species, selected from the birdDatasets, for each class. 

```{r densityPlot1D_2datasets, echo=FALSE}

#get birdDatasets
birdDatasets_1 <- lapply(birdList, FUN= function(bird){
  birdDatasets <- as.data.frame(read_csv(paste("Results/PS results AB 20 yr age classes boot ras/",bird, " _fullDataset.csv", sep = "")))
  birdDatasets$uniqueClasses <- as.character(birdDatasets$uniqueClasses)
  birdDatasets$forestedStatus <- as.character(birdDatasets$forestedStatus)
  birdDatasets$landForClass <- as.character(birdDatasets$landForClass)
  birdDatasets$birdSp <- as.character(birdDatasets$birdSp)
  birdDatasets$age <- as.integer(birdDatasets$age)
  return(birdDatasets)
})
names(birdDatasets_1) <- birdList

#get birdDatasets
birdDatasets_2 <- lapply(birdList, FUN= function(bird){
  birdDatasets <- as.data.frame(read_csv(paste("Results/PS results BC 20 yr age classes boot ras/",bird, " _fullDataset.csv", sep = "")))
  birdDatasets$uniqueClasses <- as.character(birdDatasets$uniqueClasses)
  birdDatasets$forestedStatus <- as.character(birdDatasets$forestedStatus)
  birdDatasets$landForClass <- as.character(birdDatasets$landForClass)
  birdDatasets$birdSp <- as.character(birdDatasets$birdSp)
  birdDatasets$age <- as.integer(birdDatasets$age)
  return(birdDatasets)
})
names(birdDatasets_2) <- birdList

birdData_1 <-birdDatasets_1$OVEN
dataset <- rep("AB", each = nrow(birdData_1))
birdData_1 <- cbind(birdData_1, dataset)

birdData_2 <- birdDatasets_2$OVEN
dataset <- rep("BC", each = nrow(birdData_2))
birdData_2 <- cbind(birdData_2, dataset)

birdData <- rbind(birdData_1, birdData_2)
birdData <- as.data.table(birdData)

class.labs <- c("Forested", "Water/Ice", "Wetland", "Anthro/Exposed", "Grass/Crop", "Shrub", "Bryoid", "Black Spruce", "Black Spruce Wet", "Conifer Mix", "Deciduous", "Mixed", "Pine", "White Spruce")
names(class.labs) <- c("0_0", "0_1", "0_2", "0_3", "0_4", "0_5", "0_6", "1_1", "1_2", "1_3", "1_4", "1_5", "1_6", "1_7")

nfBirdData <- birdData[forestedStatus == "0"]

  nfDensityPlot <-  ggplot(nfBirdData, aes(x=birdDensity, colour= factor(dataset, levels=c("BC", "AB")))) +
  geom_density(linewidth = 1.5) +
    facet_nested_wrap( ~  uniqueClasses,
                       labeller = labeller(uniqueClasses = class.labs),
                       ncol = 6) +
    theme_classic() +
  ggtitle("Density plots of predicted ovenbird density by cover class") +
    xlab("Predicted bird density (males/ha)")  +
    scale_x_continuous(breaks= pretty_breaks()) +
    ylab("Prevalence of value") +
    scale_y_continuous( trans='sqrt', breaks= pretty_breaks()) +
   scale_colour_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
    theme(title = element_text(size = 16),
          strip.text = element_text(
        size = 14),
           strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
          legend.title = element_blank(),
          legend.position= "none",
          axis.text.x =  element_text(size = 12, angle = 45, hjust = 1),
          axis.text.y =  element_text(size = 12),
          axis.title = element_text(size = 14),
          plot.margin = margin(0.5,0.5,0.5,0.5, "cm"),
        axis.line.y = element_line(linewidth = 1))

     nfDensityPlot
   
  forBirdData <- birdData[forestedStatus == "1"]

  forDensityPlot <-  ggplot(forBirdData, aes(x=birdDensity, colour= factor(dataset, levels=c("BC", "AB")))) +
  geom_density(linewidth = 1.5) +
    facet_nested_wrap( ~  uniqueClasses,
                       labeller = labeller(uniqueClasses = class.labs),
                       ncol = 7) +
    theme_classic() +
  ggtitle("Density plots of predicted ovenbird density by cover class") +
    xlab("Predicted bird density (males/ha)")  +
    scale_x_continuous(breaks= pretty_breaks()) +
    ylab("Prevalence of value") +
    scale_y_continuous( trans='sqrt', breaks= pretty_breaks()) +
   scale_colour_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
    theme(title = element_text(size = 16),
          strip.text = element_text(
        size = 14),
           strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
          legend.title = element_blank(),
          legend.position= "bottom",
          axis.text.x =  element_text(size = 12, angle = 45, hjust = 1),
          axis.text.y =  element_text(size = 12),
          axis.title = element_text(size = 14),
          plot.margin = margin(0.5,0.5,0.5,0.5, "cm"),
        axis.line.y = element_line(linewidth = 1))

   forDensityPlot
   
   
   allMatrixPlot <- ggarrange(nfDensityPlot +
                             theme(axis.title.x = element_blank(),
                                   title = element_blank()
                                   )
                           ,
                           forDensityPlot +
                             theme(title = element_blank())
                           ,
                           ncol = 1,
                           labels = c("A", "B"),
                           label.args = list(gp=gpar(font=4, fontsize = 16), x=unit(1,"line"), hjust=1)
                            ) 
#jpeg("densityPlot_OVEN.jpg")

```


## (two datasets) plot density plots for selected 2D bins 

```{r plot2DDensity_2datasets, echo=FALSE}
dev.new()
#get birdDatasets for first set of results
birdDatasets <- lapply(birdList, FUN= function(bird){
  birdDatasets <- as.data.frame(read_csv(paste("Results/PS results AB 20 yr age classes boot ras/",bird, " _fullDataset.csv", sep = "")))
  birdDatasets$uniqueClasses <- as.character(birdDatasets$uniqueClasses)
  birdDatasets$forestedStatus <- as.character(birdDatasets$forestedStatus)
  birdDatasets$landForClass <- as.character(birdDatasets$landForClass)
  birdDatasets$birdSp <- as.character(birdDatasets$birdSp)
  birdDatasets$age <- as.integer(birdDatasets$age)
  return(birdDatasets)
})
names(birdDatasets) <- birdList

#get age class definitions table
ageClassDefs <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/ageClassDefs"))

#select bird Sp
forestedDT <- as.data.table(birdDatasets$OVEN)

#separate out data table rows that are forested from the raw birdDataset 
forestedDT <- forestedDT[forestedDT$forestedStatus == 1]
forestedDT <- droplevels(forestedDT)

#get rid of any rows with NA for age
forestedDT <- na.omit(forestedDT, cols = "age")

#get age classes for each row using the ageClassDefs table
ageClass <- forestedDT[, age]
ageClass <- as.data.table(ageClass)
ageClass[] <- lapply(ageClass, function(x) ageClassDefs$ageClasses[match(x, ageClassDefs$allAges)])

#add the ageClass to the forestedDT 
birdDataNew <- cbind(forestedDT, ageClass)
birdDataNew$ageClass <- as.character(birdDataNew$ageClass)

#create new column, landAgeClass, giving the uniqueLandClass and ageClass combined
birdDataNew <- as.data.table(unite(birdDataNew, landAgeClass, c(uniqueClasses, ageClass), sep= ".", remove=FALSE))
dataset <- rep("AB", each = nrow(birdDataNew))
birdDataNew_1 <- cbind(birdDataNew, dataset)


#get birdDatasets for second set of results
birdDatasets <- lapply(birdList, FUN= function(bird){
  birdDatasets <- as.data.frame(read_csv(paste("Results/PS results BC 20 yr age classes boot ras/",bird, " _fullDataset.csv", sep = "")))
  birdDatasets$uniqueClasses <- as.character(birdDatasets$uniqueClasses)
  birdDatasets$forestedStatus <- as.character(birdDatasets$forestedStatus)
  birdDatasets$landForClass <- as.character(birdDatasets$landForClass)
  birdDatasets$birdSp <- as.character(birdDatasets$birdSp)
  birdDatasets$age <- as.integer(birdDatasets$age)
  return(birdDatasets)
})
names(birdDatasets) <- birdList

#get age class definitions table
ageClassDefs <- as.data.frame(read_csv("Results/PS results BC 20 yr age classes boot ras/ageClassDefs"))

#select bird Sp
forestedDT <- as.data.table(birdDatasets$OVEN)

#separate out data table rows that are forested from the raw birdDataset 
forestedDT <- forestedDT[forestedDT$forestedStatus == 1]
forestedDT <- droplevels(forestedDT)

#get rid of any rows with NA for age
forestedDT <- na.omit(forestedDT, cols = "age")

#get age classes for each row using the ageClassDefs table
ageClass <- forestedDT[, age]
ageClass <- as.data.table(ageClass)
ageClass[] <- lapply(ageClass, function(x) ageClassDefs$ageClasses[match(x, ageClassDefs$allAges)])

#add the ageClass to the forestedDT 
birdDataNew <- cbind(forestedDT, ageClass)
birdDataNew$ageClass <- as.character(birdDataNew$ageClass)

#create new column, landAgeClass, giving the uniqueLandClass and ageClass combined
birdDataNew <- as.data.table(unite(birdDataNew, landAgeClass, c(uniqueClasses, ageClass), sep= ".", remove=FALSE))
dataset <- rep("BC", each = nrow(birdDataNew))
birdDataNew_2 <- cbind(birdDataNew, dataset)


# birdDataNew <- rbind(birdDataNew_2, birdDataNew_1)

#make density plot of single land class

OVEN_1_4_AB <- birdDataNew_1[uniqueClasses == "1_4"]
OVEN_1_4_AB

OVEN_1_4_BC <- birdDataNew_2[uniqueClasses == "1_4"]
OVEN_1_4_BC

# New facet label names for detase tNames
class.labs <- c( "British Columbia", "Alberta")
names(class.labs) <- c("BC","AB" )

densityPlot_OVEN_1_4_AB <-  ggplot(OVEN_1_4_AB, 
                                aes(x=birdDensity,
                                    colour=ageClass)) +
  geom_density(alpha=.25, ) +
  # #geom_density(color="darkblue", fill="white")
  # #facet_wrap( ~ factor(dataset, labels = c( "British Columbia", "Alberta"), levels = c("BC","AB" )), nrow = 2,
  #             scales = "free_y") +
  scale_colour_manual(name='Age (yrs)',labels=c("0-20", "21-40", "41-60", "61-80", "81-100", "101-120", "121-140", "141-160", "161+"), values = c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "black")) +
  # scale_fill_discrete(breaks=c("1", "2", "3", "4", "5", "6", "7", "8", "9"),
  #                     labels=c("0-20", "21-40", "41-60", "61-80", "81-100", "101-120", "121-140", "141-160", "161+")) +
  theme_classic() +
  geom_density(linewidth = 1.5)+
  # scale_color_manual(values=c("#C7E9C0", "#A1D99B", "#74C476", "#41AB5D", "#238B45", "#005A32"))+
  ggtitle("Distribution of ovenbird density values \nin deciduous forest, by age") +
  xlab("Predicted bird density (males/ha)")  +
  scale_x_continuous(breaks= pretty_breaks()) +
  ylab("Density of value") +
  #scale_colour_manual(values = cbPalette) +
  scale_y_continuous(breaks= pretty_breaks()) +
  theme(title = element_text(size = 16),
        strip.text = element_text(
          size = 14),
        strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
         legend.position= "none",
        legend.title = element_text("Age (yrs)"),
        axis.text = element_text(size = 12),
        axis.title = element_text(size = 14),
        plot.margin = margin(0.5,0.5,0.5,0.5, "cm"),
        axis.line.y = element_line(linewidth = 1))


densityPlot_OVEN_1_4_BC <-  ggplot(OVEN_1_4_BC, 
                                aes(x=birdDensity,
                                    colour=ageClass)) +
  geom_density(alpha=.25, ) +
  # #geom_density(color="darkblue", fill="white")
  # #facet_wrap( ~ factor(dataset, labels = c( "British Columbia", "Alberta"), levels = c("BC","AB" )), nrow = 2,
  #             scales = "free_y") +
  scale_colour_manual(name='Age (yrs)',labels=c("0-20", "21-40", "41-60", "61-80", "81-100", "101-120", "121-140", "141-160", "161+"), values = c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "black")) +
  # scale_fill_discrete(breaks=c("1", "2", "3", "4", "5", "6", "7", "8", "9"),
  #                     labels=c("0-20", "21-40", "41-60", "61-80", "81-100", "101-120", "121-140", "141-160", "161+")) +
  theme_classic() +
  geom_density(linewidth = 1.5)+
  # scale_color_manual(values=c("#C7E9C0", "#A1D99B", "#74C476", "#41AB5D", "#238B45", "#005A32"))+
  ggtitle("Distribution of ovenbird density values \nin deciduous forest, by age") +
  xlab("Predicted bird density (males/ha)")  +
  scale_x_continuous(breaks= pretty_breaks()) +
  ylab("Density of value") +
  #scale_colour_manual(values = cbPalette) +
  scale_y_continuous(breaks= pretty_breaks()) +
  theme(title = element_text(size = 16),
        strip.text = element_text(
          size = 14),
        strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
        legend.title = element_text("Age (yrs)"),
        axis.text = element_text(size = 12),
        legend.position= "right",
        axis.title = element_text(size = 14),
        plot.margin = margin(0.5,0.5,0.5,0.5, "cm"),
        axis.line.y = element_line(linewidth = 1))

densityPlot_OVEN_1_4_AB
densityPlot_OVEN_1_4_BC

allMatrixPlot <- plot_grid(densityPlot_OVEN_1_4_BC +
                             theme(axis.title.x = element_blank(),
                                   legend.position="none",
                                   title = element_blank()
                                                                     )
                           ,
                           densityPlot_OVEN_1_4_AB +
                             theme(title = element_blank(),
                                   legend.position="none"
                                   )
                           ,
                           nrow = 2,
                           labels = c("A", "B")
                           # #legend.grob = get_legend(densityPlot_OVEN_1_4_BC),
                           # common.legend = TRUE,
                           # #legend = "bottom",
                            #label.args = list(gp=gpar(font=4, fontsize = 16), x=unit(1,"line"), hjust=1)
                            ) 

legend <- get_legend(
  # create some space to the left of the legend
  densityPlot_OVEN_1_4_BC + 
    guides(color = guide_legend(nrow = 1)) +
    theme(legend.position = "bottom") 
)

allMatrixPlot <- plot_grid(allMatrixPlot, legend, ncol = 1, rel_heights = c(1, .1))

allMatrixPlot 
# #jpeg("2DdensityPlot_OVEN_1_3.4.jpg")
# ggsave("densityPlot_OVEN_1_3.4.jpg",
#        plot = densityPlot_OVEN_1_3.4,
#        device = "jpeg")





```

## (single dataset) plot density plots for selected 2D bins 

```{r plot2DDensity, echo=FALSE}

#get birdDatasets
birdDatasets <- lapply(birdList, FUN= function(bird){
  birdDatasets <- as.data.frame(read_csv(paste("Results/PS results AB 20 yr age classes boot ras/",bird, " _fullDataset.csv", sep = "")))
  birdDatasets$uniqueClasses <- as.character(birdDatasets$uniqueClasses)
  birdDatasets$forestedStatus <- as.character(birdDatasets$forestedStatus)
  birdDatasets$landForClass <- as.character(birdDatasets$landForClass)
  birdDatasets$birdSp <- as.character(birdDatasets$birdSp)
  birdDatasets$age <- as.integer(birdDatasets$age)
  return(birdDatasets)
})
names(birdDatasets) <- birdList

#get age class definitions table
ageClassDefs <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/ageClassDefs"))

#select bird Sp
forestedDT <- as.data.table(birdDatasets$OVEN)

#separate out data table rows that are forested from the raw birdDataset 
forestedDT <- forestedDT[forestedDT$forestedStatus == 1]
forestedDT <- droplevels(forestedDT)

#get rid of any rows with NA for age
forestedDT <- na.omit(forestedDT, cols = "age")

#get age classes for each row using the ageClassDefs table
ageClass <- forestedDT[, age]
ageClass <- as.data.table(ageClass)
ageClass[] <- lapply(ageClass, function(x) ageClassDefs$ageClasses[match(x, ageClassDefs$allAges)])

#add the ageClass to the forestedDT 
birdDataNew <- cbind(forestedDT, ageClass)
birdDataNew$ageClass <- as.character(birdDataNew$ageClass)

#create new columns, landAgeClass, giving the uniqueLandClass and ageClass combined and the dataset
birdDataNew <- as.data.table(unite(birdDataNew, landAgeClass, c(uniqueClasses, ageClass), sep= ".", remove=FALSE))
dataset <- 


#make density plot of single land class

OVEN_1_4 <- birdDataNew[uniqueClasses == "1_4"]
OVEN_1_4

densityPlot_OVEN_1_4 <-  ggplot(OVEN_1_4, aes(x=birdDensity, colour=ageClass)) +
  geom_density(alpha=.25, ) +
  #geom_density(color="darkblue", fill="white")
  # facet_wrap( ~ forestedStatus + landAgeClass,
  #             labeller = labeller( forestedStatus = raster.labs),
  #             scales = "free") +
  theme_classic() +
  geom_density(linewidth = 1.5)+
  scale_color_manual(values=c("#C7E9C0", "#A1D99B", "#74C476", "#41AB5D", "#238B45", "#005A32"))+
  ggtitle("Density plot for Ovenbird in deciduous forest, by age class") +
  xlab("Predicted bird density")  +
  scale_x_continuous(breaks= pretty_breaks()) +
  ylab("Density of value") +
  scale_y_continuous(breaks= pretty_breaks()) +
  theme(title = element_text(size = 14),
        strip.text = element_text(
          size = 14),
        strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
        legend.title = element_blank(),
        axis.text= element_text(size = 12),
        axis.title = element_text(size = 14))

densityPlot_OVEN_1_4
# #jpeg("2DdensityPlot_OVEN_1_3.4.jpg")
# ggsave("densityPlot_OVEN_1_3.4.jpg",
#        plot = densityPlot_OVEN_1_3.4,
#        device = "jpeg")



#make density plot of single land age class

#good example : 1_5.4 (but in an extraploated age class for AB)
#bad example: 1_4.2

OVEN_1_3.4 <- birdDataNew[landAgeClass == "1_3.4"]
OVEN_1_3.4

densityPlot_OVEN_1_3.4 <-  ggplot(OVEN_1_3.4, aes(x=birdDensity)) +
  geom_density(alpha=.25) +
  # facet_wrap( ~ forestedStatus + landAgeClass,
  #             labeller = labeller( forestedStatus = raster.labs),
  #             scales = "free") +
  theme_classic() +
  ggtitle("Density plot for Ovenbird in conifer mixed forest, aged 61-80 yrs") +
  xlab("Predicted bird density")  +
  scale_x_continuous(breaks= pretty_breaks()) +
  ylab("Density of value") +
  scale_y_continuous(breaks= pretty_breaks()) +
  scale_fill_manual(values=c("#56B4E9", "#009E73")) +
  theme(title = element_text(size = 14),
        strip.text.x = element_text(
          size = 12),
        strip.background = element_rect(
          color="white", fill="white", linewidth =1.5),
        legend.title = element_blank(),
        axis.text.x = element_text(size = 10),
        axis.title = element_text(size = 12))

densityPlot_OVEN_1_3.4
# #jpeg("2DdensityPlot_OVEN_1_3.4.jpg")
# ggsave("densityPlot_OVEN_1_3.4.jpg",
#        plot = densityPlot_OVEN_1_3.4,
#        device = "jpeg")



```


## PLOTS OF NORMALITY AND UNIMODALITY

#for single dataset plot 1D vs 2D normality and unimodality stats by bird

```{r plotNormalityAndUnimodality, echo=FALSE}

assumpTab1D < as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/assumpTab1D.csv"))
assumptionsByBird2D <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/assumptionsByBird2D.csv"))

#get 1D bird assumptions for forested classes only
assumptionsByBird1DFor <- assumptTab1D[forestedStatus == "1"]
assumptionsByBird1DFor  <- droplevels(assumptionsByBird1DFor)
assumptionsByBird1DFor <- assumptionsByBird1DFor[order(birdSp)                                                                   ][,list(noClasses = .N,                                                               propClassesNormal = mean(normal),
                                               propClassesUnimodal = mean(unimodal),
                                               binningType = "1DBins"),                                               by = birdSp]
  assumptionsByBird1DFor

  #make into table with 2D assumptions
assumptionsbyBird <- rbind(assumptionsByBird1DFor,assumptionsByBird2D)  

#normality plot
   plotNormality <- ggplot(data = assumptionsbyBird, 
                                aes(fill= binningType, y= propClassesNormal, x= birdSp)) + 
    geom_bar(position = "dodge", stat = "identity") +
    ggtitle("Proportion of Classes Normal for 1D and 2D post-hoc binning by species") +
    xlab("Species")  +
    ylab("Proportion of classes normal (p < 0.05)") +
    scale_y_continuous(breaks= pretty_breaks()) +
    theme_classic() + 
    scale_fill_manual(values=c("#56B4E9", "#009E73"), 
                      labels = c("1D", "2D")) +
    theme(title = element_text(size = 14),
          legend.title = element_blank(),
          legend.position= "bottom",
          axis.text.x = element_text(size = 10, angle = 45, hjust = 1), 
          axis.title = element_text(size = 12))

   plotNormality

#unimodality plot
   plotUnimodality <- ggplot(data = assumptionsbyBird, 
                                aes(fill= binningType, y= propClassesUnimodal, x= birdSp)) + 
    geom_bar(position = "dodge", stat = "identity") +
    ggtitle("Proportion of classes unimodal for 1D and 2D post-hoc binning by species") +
    xlab("Species")  +
    ylab("Proportion of classes unimodal (p < 0.05)") +
    scale_y_continuous(breaks= pretty_breaks()) +
    theme_classic() + 
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c("1D", "2D")) +
    theme(title = element_text(size = 14),
          legend.title = element_blank(),
          legend.position= "bottom",
          axis.text.x = element_text(size = 10, angle = 45, hjust = 1), 
          axis.title = element_text(size = 12))

   plotUnimodality

```


## (all datasets) compare 1D and 2D prop unimodal and normal by class

```{r Unimodal and normal plot, echo=FALSE}

#get data tables needed
assumptionsByClass1D_1 <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/assumptionsByClass1D.csv"))
studyArea <- rep("AB", each = nrow(assumptionsByClass1D_1))
ageClasses <- rep("20", each = nrow(assumptionsByClass1D_1))
assumptionsByClass1D_1 <- cbind(assumptionsByClass1D_1, studyArea, ageClasses)
names(assumptionsByClass1D_1)[names(assumptionsByClass1D_1) == 'uniqueClasses'] <- 'landAgeClass'

assumptionsByClass1D_2 <- as.data.frame(read_csv("Results/PS results BC 20 yr age classes boot ras/assumptionsByClass1D.csv"))
studyArea <- rep("BC", each = nrow(assumptionsByClass1D_2))
ageClasses <- rep("20", each = nrow(assumptionsByClass1D_2))
assumptionsByClass1D_2 <- cbind(assumptionsByClass1D_2, studyArea, ageClasses)
names(assumptionsByClass1D_2)[names(assumptionsByClass1D_2) == 'uniqueClasses'] <- 'landAgeClass'

assumptionsByClass2D_1 <- as.data.frame(read_csv("Results/PS results AB 10 yr age classes boot ras/assumptionsByClass2D.csv"))
studyArea <- rep("AB", each = nrow(assumptionsByClass2D_1))
ageClasses <- rep("10", each = nrow(assumptionsByClass2D_1))
assumptionsByClass2D_1 <- cbind(assumptionsByClass2D_1, studyArea, ageClasses)

assumptionsByClass2D_2 <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/assumptionsByClass2D.csv"))
studyArea <- rep("AB", each = nrow(assumptionsByClass2D_2))
ageClasses <- rep("20", each = nrow(assumptionsByClass2D_2))
assumptionsByClass2D_2 <- cbind(assumptionsByClass2D_2, studyArea, ageClasses)

assumptionsByClass2D_3 <- as.data.frame(read_csv("Results/PS results BC 10 yr age classes boot ras/assumptionsByClass2D.csv"))
studyArea <- rep("BC", each = nrow(assumptionsByClass2D_3))
ageClasses <- rep("10", each = nrow(assumptionsByClass2D_3))
assumptionsByClass2D_3 <- cbind(assumptionsByClass2D_3, studyArea, ageClasses)

assumptionsByClass2D_4 <- as.data.frame(read_csv("Results/PS results BC 20 yr age classes boot ras/assumptionsByClass2D.csv"))
studyArea <- rep("BC", each = nrow(assumptionsByClass2D_4))
ageClasses <- rep("20", each = nrow(assumptionsByClass2D_4))
assumptionsByClass2D_4 <- cbind(assumptionsByClass2D_4, studyArea, ageClasses)

assumptionsByClass <- rbind(assumptionsByClass1D_1, assumptionsByClass1D_2, assumptionsByClass2D_1, assumptionsByClass2D_2, assumptionsByClass2D_3, assumptionsByClass2D_4)
assumptionsByClass <- unite(assumptionsByClass, dataset, c(binningType, ageClasses), remove=FALSE)

 #normality plot
   plotUnimodality <- ggplot(data = assumptionsByClass, 
                                aes(fill = factor(studyArea, levels=c("BC", "AB")), y= propBirdsUnimodal, x= dataset)) + 
    geom_boxplot() +
    geom_jitter(color="black", size=0.4, alpha=0.9) +
    ggtitle("Proportion of bird species per class \nwith a unimodal distribution (p < 0.05)") +
    xlab("Species")  +
     scale_x_discrete(labels=c("1DBins_20" = "1D", "2DBins_10" = "2D\n(10-yr)", "2DBins_20" = "2D\n(20-yr)"))  + 
    ylab("Proportion of species unimodal") +
    scale_y_continuous(breaks= pretty_breaks()) +
    theme_classic() + 
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
  theme(title = element_text(size = 16),
          legend.title = element_blank(),
          legend.position= "bottom",
          legend.text = element_text(size =14),
          axis.text.x = element_text(size = 12, angle = 45, hjust = 1), 
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          axis.title.x = element_blank(),
          plot.margin = margin(0.5,0.5,0.5,0.5, "cm"))

   plotUnimodality


# #normality plot
#    plotNormality <- ggplot(data = assumptionsByClass, 
#                                 aes(fill= dataset, y= propBirdsNormal, x= binningType)) + 
#     geom_boxplot() +
#     geom_jitter(color="black", size=0.4, alpha=0.9) +
#     ggtitle("Proportion of bird species Normal for 1D and 2D post-hoc binning by cover class") +
#     xlab("Species")  +
#     ylab("Proportion of classes normal (p < 0.05)") +
#     scale_y_continuous(breaks= pretty_breaks()) +
#     theme_classic() + 
#     scale_fill_manual(values=c("#56B4E9","#CC79A7", "#009E73", "#999999"), 
#                       labels = c("Alberta, 10 yr age classes", "Alberta, 20 yr age classes", "British Columbia, 10 yr age classes", "British Columbia, 20 yr age classes")) +
#     theme(title = element_text(size = 14),
#           legend.title = element_blank(),
#           legend.position= "bottom",
#           axis.text.x = element_text(size = 10, angle = 45, hjust = 1), 
#           axis.title = element_text(size = 12))
# 
#    plotNormality
   
  
```


## PLOTS OF GBM STATS

## Plot relative influence for age and forest class

Here a graph of the gbm relative influence for age and cover class is plotted.

```{r plotRelInf, echo=FALSE}
dev.new()

statsGBM_AB10 <- as.data.frame(read_csv("Results/PS results AB 10 yr age classes boot ras/statsGBM"))
studyArea <- rep("AB", each = nrow(statsGBM_AB10))
ageClasses <- rep("10", each = nrow(statsGBM_AB10))
statsGBM_AB10 <- cbind(statsGBM_AB10, studyArea, ageClasses)


statsGBM_AB20 <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/statsGBM"))
studyArea <- rep("AB", each = nrow(statsGBM_AB20))
ageClasses <- rep("20", each = nrow(statsGBM_AB20))
statsGBM_AB20 <- cbind(statsGBM_AB20, studyArea, ageClasses)


statsGBM_BC10 <- as.data.frame(read_csv("Results/PS results BC 10 yr age classes boot ras/statsGBM"))
studyArea <- rep("BC", each = nrow(statsGBM_BC10))
ageClasses <- rep("10", each = nrow(statsGBM_BC10))
statsGBM_BC10 <- cbind(statsGBM_BC10, studyArea, ageClasses)


statsGBM_BC20 <- as.data.frame(read_csv("Results/PS results BC 20 yr age classes boot ras/statsGBM"))
studyArea <- rep("BC", each = nrow(statsGBM_BC20))
ageClasses <- rep("20", each = nrow(statsGBM_BC20))
statsGBM_BC20 <- cbind(statsGBM_BC20, studyArea, ageClasses)


statsGBM <- rbind(statsGBM_AB10, statsGBM_AB20, statsGBM_BC10, statsGBM_BC20)
#statsGBM$ageClasses <- as.numeric(statsGBM$ageClasses)

# autoCorStats <- gather(data=statsGBM, key="binningType", value="autocorStat", autocor1DRes, autocor2DRes, -studyArea, -ageClasses, -birdSp)
# autoCorStats <- unite(autoCorStats, dataset, c(binningType, ageClasses), remove=FALSE)
statsGBM <- statsGBM[,c(2,5:7)]
statsGBM <-na.omit(statsGBM)

plotRelInf <- ggplot(data = statsGBM,
                            aes(fill = factor(studyArea, levels=c("BC", "AB")), 
                                y= relInfAge, 
                                x= ageClasses)) + 
    geom_boxplot() +
    ggtitle("Relative influence of forest age \namong species") +
    #xlab()  +
    ylab("Relative influence of age (%)") +
    scale_y_continuous(breaks= pretty_breaks()) +
    scale_x_discrete(labels=c("10" = "10-yr age \nclasses", "20" = "20-yr age \nclasses"))  + 
    theme_classic() + 
   scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
    theme(title = element_text(size = 16),
          legend.title = element_blank(),
          legend.position= "bottom",
          legend.text = element_text(size =14),
          axis.text.x = element_text(size = 12, angle = 45, hjust = 1), 
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          axis.title.x = element_blank(),
          plot.margin = margin(0.5,0.5,0.5,0.5, "cm"))

   plotRelInf
   
   
```

#plot friedman's h stat

```{r plotFriedmansH, echo=FALSE}
dev.new()

statsGBM_AB10 <- as.data.frame(read_csv("Results/PS results AB 10 yr age classes boot ras/statsGBM"))
studyArea <- rep("AB", each = nrow(statsGBM_AB10))
ageClasses <- rep("10", each = nrow(statsGBM_AB10))
statsGBM_AB10 <- cbind(statsGBM_AB10, studyArea, ageClasses)


statsGBM_AB20 <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/statsGBM"))
studyArea <- rep("AB", each = nrow(statsGBM_AB20))
ageClasses <- rep("20", each = nrow(statsGBM_AB20))
statsGBM_AB20 <- cbind(statsGBM_AB20, studyArea, ageClasses)


statsGBM_BC10 <- as.data.frame(read_csv("Results/PS results BC 10 yr age classes boot ras/statsGBM"))
studyArea <- rep("BC", each = nrow(statsGBM_BC10))
ageClasses <- rep("10", each = nrow(statsGBM_BC10))
statsGBM_BC10 <- cbind(statsGBM_BC10, studyArea, ageClasses)


statsGBM_BC20 <- as.data.frame(read_csv("Results/PS results BC 20 yr age classes boot ras/statsGBM"))
studyArea <- rep("BC", each = nrow(statsGBM_BC20))
ageClasses <- rep("20", each = nrow(statsGBM_BC20))
statsGBM_BC20 <- cbind(statsGBM_BC20, studyArea, ageClasses)


statsGBM <- rbind(statsGBM_AB10, statsGBM_AB20, statsGBM_BC10, statsGBM_BC20)
#statsGBM$ageClasses <- as.numeric(statsGBM$ageClasses)

# autoCorStats <- gather(data=statsGBM, key="binningType", value="autocorStat", autocor1DRes, autocor2DRes, -studyArea, -ageClasses, -birdSp)
# autoCorStats <- unite(autoCorStats, dataset, c(binningType, ageClasses), remove=FALSE)
statsGBM <- statsGBM[,c(2,3,6,7)]
statsGBM <-na.omit(statsGBM)

plotFrH <- ggplot(data = statsGBM,
                            aes(fill = factor(studyArea, levels=c("BC", "AB")), 
                                y= FriedmansHStat, 
                                x= ageClasses)) + 
    geom_boxplot() +
    ggtitle("Interaction between forest class and age \nacross species") +
    #xlab()  +
    ylab("Friedman's H-statistic") +
    scale_y_continuous(breaks= pretty_breaks()) +
    scale_x_discrete(labels=c("10" = "10-yr age \nclasses", "20" = "20-yr age \nclasses"))  + 
    theme_classic() + 
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
    theme(title = element_text(size = 16),
          legend.title = element_blank(),
          legend.position= "bottom",
          legend.text = element_text(size =14),
          axis.text.x = element_text(size = 12, angle = 45, hjust = 1), 
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          axis.title.x = element_blank(),
          plot.margin = margin(0.5,0.5,0.5,0.5, "cm"))

   plotFrH
   
   
```



## Both rel inf and friedman
```{r plotBothRelInfAndFriedmansH, echo=FALSE}


# statsGBM_AB10 <- as.data.frame(read_csv("Results/PS results AB 10 yr age classes boot ras/statsGBM"))
# studyArea <- rep("AB", each = nrow(statsGBM_AB10))
# ageClasses <- rep("10", each = nrow(statsGBM_AB10))
# statsGBM_AB10 <- cbind(statsGBM_AB10, studyArea, ageClasses)


statsGBM_AB20 <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/statsGBM"))
studyArea <- rep("AB", each = nrow(statsGBM_AB20))
ageClasses <- rep("20", each = nrow(statsGBM_AB20))
statsGBM_AB20 <- cbind(statsGBM_AB20, studyArea, ageClasses)


# statsGBM_BC10 <- as.data.frame(read_csv("Results/PS results BC 10 yr age classes boot ras/statsGBM"))
# studyArea <- rep("BC", each = nrow(statsGBM_BC10))
# ageClasses <- rep("10", each = nrow(statsGBM_BC10))
# statsGBM_BC10 <- cbind(statsGBM_BC10, studyArea, ageClasses)


statsGBM_BC20 <- as.data.frame(read_csv("Results/PS results BC 20 yr age classes boot ras/statsGBM"))
studyArea <- rep("BC", each = nrow(statsGBM_BC20))
ageClasses <- rep("20", each = nrow(statsGBM_BC20))
statsGBM_BC20 <- cbind(statsGBM_BC20, studyArea, ageClasses)


statsGBM <- rbind( statsGBM_AB20, statsGBM_BC20)
#statsGBM$ageClasses <- as.numeric(statsGBM$ageClasses)

# autoCorStats <- gather(data=statsGBM, key="binningType", value="autocorStat", autocor1DRes, autocor2DRes, -studyArea, -ageClasses, -birdSp)
# autoCorStats <- unite(autoCorStats, dataset, c(binningType, ageClasses), remove=FALSE)

statsRelInf <- statsGBM[,c(2,5:7)]
statsRelInf <-na.omit(statsRelInf)
# 
plotRelInf <- ggplot(data = statsRelInf,
                            aes(fill = factor(studyArea, levels=c("BC", "AB")),
                                y= relInfAge,
                                x= ageClasses)) +
    geom_boxplot() +
    ggtitle("Relative influence of forest age \namong species") +
    #xlab()  +
    ylab("Relative influence of age (%)") +
    scale_y_continuous(breaks= pretty_breaks()) +
    #scale_x_discrete(labels=c("20" = "20-yr age \nclasses"))  +
    theme_classic() +
   scale_fill_manual(values=c("#009E73", "#56B4E9"),
                      labels = c( "British Columbia", "Alberta")) +
    theme(title = element_text(size = 16),
          legend.title = element_blank(),
          legend.position= "bottom",
          legend.text = element_text(size =14),
          axis.text.x = element_blank(),
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          axis.line.y = element_line(linewidth = 1),
          axis.ticks.x = element_blank(),
          plot.margin = margin(0.5,0.5,0.5,0.5, "cm"),
          axis.title.x = element_blank()
          )

 plotRelInf 
 
 
statsFriH <- statsGBM[,c(2,3,6,7)]
statsFriH <-na.omit(statsFriH)

plotFrH <- ggplot(data = statsFriH,
                            aes(fill = factor(studyArea, levels=c("BC", "AB")), 
                                y= FriedmansHStat, 
                                x= ageClasses)) + 
    geom_boxplot() +
    ggtitle("Interaction between forest class and age \nacross species") +
    #xlab()  +
    ylab("Friedman's H-statistic") +
    scale_y_continuous(breaks= pretty_breaks()) +
    #scale_x_discrete(labels=c("10" = "10-yr age \nclasses", "20" = "20-yr age \nclasses"))  + 
    theme_classic() + 
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
    theme(title = element_text(size = 16),
          legend.title = element_blank(),
          legend.position= "bottom",
          legend.text = element_text(size =14),
          axis.text.x = element_blank(), 
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          axis.line.y = element_line(linewidth = 1),
          axis.ticks.x = element_blank(),
          plot.margin = margin(0.5,0.5,0.5,0.5, "cm"),
          axis.title.x = element_blank()
          )

 plotFrH



#plot_grid(plotRelInf, plotFrH, labels = c('A', 'B'), label_size = 12)
  dev.new() 
  allMatrixPlot <- ggarrange(plotFrH +
                             theme(axis.text.x = element_blank(),
                                   axis.title.x = element_blank(),
                                   title = element_blank(),
                                   legend.position= "none")
                           ,
                           plotRelInf +
                             theme(title = element_blank())
                           ,
                           ncol = 1,
                           labels = c("A", "B"),
                           label.args = list(gp=gpar(font=4, fontsize = 16), x=unit(1,"line"), hjust=1)
                            ) 
  


```




## PLOTS OF MAP STATS

#spearman Stats (all datasets)
```{r plotSpearman, echo=FALSE}

spearmanStats_AB10 <- as.data.frame(read_csv("Results/PS results AB 10 yr age classes boot ras/spearmanStats.csv"))
studyArea <- rep("AB", each = nrow(spearmanStats_AB10))
ageClasses <- rep("10", each = nrow(spearmanStats_AB10))
spearmanStats_AB10 <- cbind(spearmanStats_AB10, studyArea, ageClasses)
spearmanStats_AB10[,2] <- NA

spearmanStats_AB20 <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/spearmanStats.csv"))
studyArea <- rep("AB", each = nrow(spearmanStats_AB20))
ageClasses <- rep("20", each = nrow(spearmanStats_AB20))
spearmanStats_AB20 <- cbind(spearmanStats_AB20, studyArea, ageClasses)

spearmanStats_BC10 <- as.data.frame(read_csv("Results/PS results BC 10 yr age classes boot ras/spearmanStats.csv"))
studyArea <- rep("BC", each = nrow(spearmanStats_BC10))
ageClasses <- rep("10", each = nrow(spearmanStats_BC10))
spearmanStats_BC10 <- cbind(spearmanStats_BC10, studyArea, ageClasses)
spearmanStats_BC10[,2] <- NA

spearmanStats_BC20 <- as.data.frame(read_csv("Results/PS results BC 20 yr age classes boot ras/spearmanStats.csv"))
studyArea <- rep("BC", each = nrow(spearmanStats_BC20))
ageClasses <- rep("20", each = nrow(spearmanStats_BC20))
spearmanStats_BC20 <- cbind(spearmanStats_BC20, studyArea, ageClasses)

spearmanStats <- rbind(spearmanStats_AB10, spearmanStats_AB20, spearmanStats_BC10, spearmanStats_BC20)
names(spearmanStats)[names(spearmanStats) == '...1'] <- 'birdSp'
spearmanStats$ageClasses <- as.numeric(spearmanStats$ageClasses)

spearmanStats <- gather(data=spearmanStats, key="binningType", value="spearmanStat", -studyArea, -ageClasses, -birdSp)
spearmanStats <- unite(spearmanStats, dataset, c(binningType, ageClasses), remove=FALSE)
spearmanStats <-na.omit(spearmanStats)

plotSpearmanStats <- ggplot(data = spearmanStats,
                            aes(fill = factor(studyArea, levels=c("BC", "AB")), 
                                y= spearmanStat, 
                                x= dataset)) + 
    geom_boxplot() +
    ggtitle("Correlation between BAM national models \nand mapped predictions, across bird species") +
    #xlab()  +
    scale_x_discrete(labels=c("spearman1D_20" = "1D", "spearman2D_10" = "2D \n(10-yr)", "spearman2D_20" = "2D \n(20-yr)"))  + 
    ylab("Spearman's coefficient ()") +
    scale_y_continuous(breaks= pretty_breaks()) +
    theme_classic() + 
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
    theme(title = element_text(size = 15),
          legend.title = element_blank(),
          legend.position= "bottom",
          legend.text = element_text(size =14),
          axis.text.x = element_text(size = 12, angle = 45, hjust = 1), 
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          axis.title.x = element_blank(),
          plot.margin = margin(0.5,0.5,0.5,0.5, "cm"))

     plotSpearmanStats


```


#autocor Stats (all datasets)
```{r plotAutocorStats, echo=FALSE}

resStats_AB10 <- as.data.frame(read_csv("Results/PS results AB 10 yr age classes boot ras/resStats.csv"))
studyArea <- rep("AB", each = nrow(resStats_AB10))
ageClasses <- rep("10", each = nrow(resStats_AB10))
resStats_AB10 <- cbind(resStats_AB10, studyArea, ageClasses)
resStats_AB10[,4] <- NA
resStats_AB10 <- resStats_AB10[,c(1,4:7)]

resStats_AB20 <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/resStats.csv"))
studyArea <- rep("AB", each = nrow(resStats_AB20))
ageClasses <- rep("20", each = nrow(resStats_AB20))
resStats_AB20 <- cbind(resStats_AB20, studyArea, ageClasses)
resStats_AB20 <- resStats_AB20[,c(1,4:7)]

resStats_BC10 <- as.data.frame(read_csv("Results/PS results BC 10 yr age classes boot ras/resStats.csv"))
studyArea <- rep("BC", each = nrow(resStats_BC10))
ageClasses <- rep("10", each = nrow(resStats_BC10))
resStats_BC10 <- cbind(resStats_BC10, studyArea, ageClasses)
resStats_BC10[,4] <- NA
resStats_BC10 <- resStats_BC10[,c(1,4:7)]

resStats_BC20 <- as.data.frame(read_csv("Results/PS results BC 20 yr age classes boot ras/resStats.csv"))
studyArea <- rep("BC", each = nrow(resStats_BC20))
ageClasses <- rep("20", each = nrow(resStats_BC20))
resStats_BC20 <- cbind(resStats_BC20, studyArea, ageClasses)
resStats_BC20 <- resStats_BC20[,c(1,4:7)]

resStats <- rbind(resStats_AB10, resStats_AB20, resStats_BC10, resStats_BC20)
names(resStats)[names(resStats) == '...1'] <- 'birdSp'
resStats$ageClasses <- as.numeric(resStats$ageClasses)

autoCorStats <- gather(data=resStats, key="binningType", value="autocorStat", autocor1DRes, autocor2DRes, -studyArea, -ageClasses, -birdSp)
autoCorStats <- unite(autoCorStats, dataset, c(binningType, ageClasses), remove=FALSE)
autoCorStats <-na.omit(autoCorStats)

plotAutocorStats <- ggplot(data = autoCorStats,
                            aes(fill = factor(studyArea, levels=c("BC", "AB")), 
                                y= autocorStat, 
                                x= dataset)) + 
    geom_boxplot() +
    ggtitle("Spatial autocorrelation of mapped residuals, \nacross bird species") +
    #xlab()  +
    ylab("Moran's I") +
    scale_y_continuous(breaks= pretty_breaks()) +
    scale_x_discrete(labels=c("autocor1DRes_20" = "1D", "autocor2DRes_10" = "2D \n(10-yr)", "autocor2DRes_20" = "2D \n(20-yr)"))  + 
    theme_classic() + 
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
    theme(title = element_text(size = 16),
          legend.title = element_blank(),
          legend.position= "bottom",
          legend.text = element_text(size =14),
          axis.text.x = element_text(size = 12, angle = 45, hjust = 1), 
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          axis.title.x = element_blank(),
          plot.margin = margin(0.5,0.5,0.5,0.5, "cm"))

   plotAutocorStats
   
   
```


#median residual Stats (all datasets)
```{r plotMedResStats, echo=FALSE}

resStats_AB10 <- as.data.frame(read_csv("Results/PS results AB 10 yr age classes boot ras/resStats.csv"))
studyArea <- rep("AB", each = nrow(resStats_AB10))
ageClasses <- rep("10", each = nrow(resStats_AB10))
resStats_AB10 <- cbind(resStats_AB10, studyArea, ageClasses)
resStats_AB10[,2] <- NA
resStats_AB10 <- resStats_AB10[,c(1:3,6,7)]

resStats_AB20 <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/resStats.csv"))
studyArea <- rep("AB", each = nrow(resStats_AB20))
ageClasses <- rep("20", each = nrow(resStats_AB20))
resStats_AB20 <- cbind(resStats_AB20, studyArea, ageClasses)
resStats_AB20 <- resStats_AB20[,c(1:3,6,7)]

resStats_BC10 <- as.data.frame(read_csv("Results/PS results BC 10 yr age classes boot ras/resStats.csv"))
studyArea <- rep("BC", each = nrow(resStats_BC10))
ageClasses <- rep("10", each = nrow(resStats_BC10))
resStats_BC10 <- cbind(resStats_BC10, studyArea, ageClasses)
resStats_BC10[,2] <- NA
resStats_BC10 <- resStats_BC10[,c(1:3,6,7)]

resStats_BC20 <- as.data.frame(read_csv("Results/PS results BC 20 yr age classes boot ras/resStats.csv"))
studyArea <- rep("BC", each = nrow(resStats_BC20))
ageClasses <- rep("20", each = nrow(resStats_BC20))
resStats_BC20 <- cbind(resStats_BC20, studyArea, ageClasses)
resStats_BC20 <- resStats_BC20[,c(1:3,6,7)]

resStats <- rbind(resStats_AB10, resStats_AB20, resStats_BC10, resStats_BC20)
names(resStats)[names(resStats) == '...1'] <- 'birdSp'
resStats$ageClasses <- as.numeric(resStats$ageClasses)

medResStats <- gather(data=resStats, key="binningType", value= "medianResStat",
median1DRes, median2DRes, -studyArea, -ageClasses, -birdSp)
medResStats <- unite(medResStats, dataset, c(binningType, ageClasses), remove=FALSE)
medResStats <-na.omit(medResStats)

plotMedRes <- ggplot(data = medResStats,
                            aes(fill = factor(studyArea, levels=c("BC", "AB")), 
                                y= medianResStat, 
                                x= dataset)) + 
    geom_boxplot() +
    ggtitle("Median value of residuals per bird species") +
    #xlab()  +
    ylab("Median residual value") +
    scale_y_continuous(breaks= pretty_breaks()) +
    scale_x_discrete(labels=c("median1DRes_20" = "1D bins", "median2DRes_10" = "2D bins \n(10yr)", "median2DRes_20" = "2D bins \n(20yr)"))  + 
    theme_classic() + 
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
    theme(title = element_text(size = 16),
          legend.title = element_blank(),
          legend.position= "bottom",
          legend.text = element_text(size =14),
          axis.text.x = element_text(size = 12, angle = 45, hjust = 1), 
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          axis.title.x = element_blank(),
          plot.margin = margin(0.5,0.5,0.5,0.5, "cm"))

   plotMedRes
   
   




```


#Combined unimodality, spearman and morans 

```{r plotCombinedUnimodSpearAndMoran, echo=FALSE}

#get data tables needed
assumptionsByClass1D_1 <- as.data.table(read_csv("Results/PS results AB 20 yr age classes boot ras/assumptionsByClass1D.csv"))
assumptionsByClass1D_1 <- assumptionsByClass1D_1[7:13]
assumptionsByClass1D_1  <- droplevels(assumptionsByClass1D_1)
studyArea <- rep("AB", each = nrow(assumptionsByClass1D_1))
ageClasses <- rep("20", each = nrow(assumptionsByClass1D_1))
assumptionsByClass1D_1 <- cbind(assumptionsByClass1D_1, studyArea, ageClasses)
names(assumptionsByClass1D_1)[names(assumptionsByClass1D_1) == 'uniqueClasses'] <- 'landAgeClass'

assumptionsByClass1D_2 <- as.data.table(read_csv("Results/PS results BC 20 yr age classes boot ras/assumptionsByClass1D.csv"))
assumptionsByClass1D_2 <- assumptionsByClass1D_2[7:13]
assumptionsByClass1D_2  <- droplevels(assumptionsByClass1D_2)
studyArea <- rep("BC", each = nrow(assumptionsByClass1D_2))
ageClasses <- rep("20", each = nrow(assumptionsByClass1D_2))
assumptionsByClass1D_2 <- cbind(assumptionsByClass1D_2, studyArea, ageClasses)
names(assumptionsByClass1D_2)[names(assumptionsByClass1D_2) == 'uniqueClasses'] <- 'landAgeClass'

# assumptionsByClass2D_1 <- as.data.frame(read_csv("Results/PS results AB 10 yr age classes boot ras/assumptionsByClass2D.csv"))
# studyArea <- rep("AB", each = nrow(assumptionsByClass2D_1))
# ageClasses <- rep("10", each = nrow(assumptionsByClass2D_1))
# assumptionsByClass2D_1 <- cbind(assumptionsByClass2D_1, studyArea, ageClasses)

assumptionsByClass2D_2 <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/assumptionsByClass2D.csv"))
studyArea <- rep("AB", each = nrow(assumptionsByClass2D_2))
ageClasses <- rep("20", each = nrow(assumptionsByClass2D_2))
assumptionsByClass2D_2 <- cbind(assumptionsByClass2D_2, studyArea, ageClasses)

# assumptionsByClass2D_3 <- as.data.frame(read_csv("Results/PS results BC 10 yr age classes boot ras/assumptionsByClass2D.csv"))
# studyArea <- rep("BC", each = nrow(assumptionsByClass2D_3))
# ageClasses <- rep("10", each = nrow(assumptionsByClass2D_3))
# assumptionsByClass2D_3 <- cbind(assumptionsByClass2D_3, studyArea, ageClasses)

assumptionsByClass2D_4 <- as.data.frame(read_csv("Results/PS results BC 20 yr age classes boot ras/assumptionsByClass2D.csv"))
studyArea <- rep("BC", each = nrow(assumptionsByClass2D_4))
ageClasses <- rep("20", each = nrow(assumptionsByClass2D_4))
assumptionsByClass2D_4 <- cbind(assumptionsByClass2D_4, studyArea, ageClasses)

assumptionsByClass <- rbind(assumptionsByClass1D_1, assumptionsByClass1D_2, assumptionsByClass2D_2, assumptionsByClass2D_4)
assumptionsByClass <- unite(assumptionsByClass, dataset, c(binningType, ageClasses), remove=FALSE)

 #normality plot
   plotUnimodality <- ggplot(data = assumptionsByClass, 
                                aes(fill = factor(studyArea, levels=c("BC", "AB")), y= propBirdsUnimodal, x= dataset)) + 
    geom_boxplot() +
    geom_jitter(color="black", size=0.4, alpha=0.9) +
    ggtitle("Proportion of bird species per class \nwith a unimodal distribution (p < 0.05)") +
    xlab("Species")  +
     scale_x_discrete(labels=c("1DBins_20" = "1D", "2DBins_20" = "2D"))  + 
    ylab("Proportion of \nspecies unimodal") +
    scale_y_continuous(breaks= pretty_breaks()) +
    theme_classic() + 
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
  theme(title = element_text(size = 16),
          legend.title = element_blank(),
          legend.position= "bottom",
          legend.text = element_text(size =14),
          axis.text.x = element_text(size = 14, angle = 45, hjust = 1), 
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          axis.title.x = element_blank(),
          plot.margin = margin(0.5,0.5,0,0.5, "cm"),
         axis.line.y = element_line(linewidth = 1))

   plotUnimodality

##################################################################
   
#    spearmanStats_AB10 <- as.data.frame(read_csv("Results/PS results AB 10 yr age classes boot ras/spearmanStats.csv"))
# studyArea <- rep("AB", each = nrow(spearmanStats_AB10))
# ageClasses <- rep("10", each = nrow(spearmanStats_AB10))
# spearmanStats_AB10 <- cbind(spearmanStats_AB10, studyArea, ageClasses)
# spearmanStats_AB10[,2] <- NA

spearmanStats_AB20 <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/spearmanStats.csv"))
studyArea <- rep("AB", each = nrow(spearmanStats_AB20))
ageClasses <- rep("20", each = nrow(spearmanStats_AB20))
spearmanStats_AB20 <- cbind(spearmanStats_AB20, studyArea, ageClasses)

# spearmanStats_BC10 <- as.data.frame(read_csv("Results/PS results BC 10 yr age classes boot ras/spearmanStats.csv"))
# studyArea <- rep("BC", each = nrow(spearmanStats_BC10))
# ageClasses <- rep("10", each = nrow(spearmanStats_BC10))
# spearmanStats_BC10 <- cbind(spearmanStats_BC10, studyArea, ageClasses)
# spearmanStats_BC10[,2] <- NA

spearmanStats_BC20 <- as.data.frame(read_csv("Results/PS results BC 20 yr age classes boot ras/spearmanStats.csv"))
studyArea <- rep("BC", each = nrow(spearmanStats_BC20))
ageClasses <- rep("20", each = nrow(spearmanStats_BC20))
spearmanStats_BC20 <- cbind(spearmanStats_BC20, studyArea, ageClasses)

spearmanStats <- rbind( spearmanStats_AB20, spearmanStats_BC20)
names(spearmanStats)[names(spearmanStats) == '...1'] <- 'birdSp'
spearmanStats$ageClasses <- as.numeric(spearmanStats$ageClasses)

spearmanStats <- gather(data=spearmanStats, key="binningType", value="spearmanStat", -studyArea, -ageClasses, -birdSp)
spearmanStats <- unite(spearmanStats, dataset, c(binningType, ageClasses), remove=FALSE)
spearmanStats <-na.omit(spearmanStats)

plotSpearmanStats <- ggplot(data = spearmanStats,
                            aes(fill = factor(studyArea, levels=c("BC", "AB")), 
                                y= spearmanStat, 
                                x= dataset)) + 
    geom_boxplot() +
    ggtitle("Correlation between BAM national models \nand mapped predictions, across bird species") +
    #xlab()  +
    scale_x_discrete(labels=c("spearman1D_20" = "1D", "spearman2D_20" = "2D"))  + 
    ylab("Spearman's \ncoefficient ()") +
    scale_y_continuous(breaks= pretty_breaks()) +
    theme_classic() + 
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
    theme(title = element_text(size = 15),
          legend.title = element_blank(),
          legend.position= "bottom",
          legend.text = element_text(size =14),
          axis.text.x = element_text(size = 12, angle = 45, hjust = 1), 
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          axis.title.x = element_blank(),
          plot.margin = margin(0.5,0.5,0,0.5, "cm"),
           axis.line.y = element_line(linewidth = 1))

     plotSpearmanStats

##################################################################
     
# resStats_AB10 <- as.data.frame(read_csv("Results/PS results AB 10 yr age classes boot ras/resStats.csv"))
# studyArea <- rep("AB", each = nrow(resStats_AB10))
# ageClasses <- rep("10", each = nrow(resStats_AB10))
# resStats_AB10 <- cbind(resStats_AB10, studyArea, ageClasses)
# resStats_AB10[,4] <- NA
# resStats_AB10 <- resStats_AB10[,c(1,4:7)]

resStats_AB20 <- as.data.frame(read_csv("Results/PS results AB 20 yr age classes boot ras/resStats.csv"))
studyArea <- rep("AB", each = nrow(resStats_AB20))
ageClasses <- rep("20", each = nrow(resStats_AB20))
resStats_AB20 <- cbind(resStats_AB20, studyArea, ageClasses)
resStats_AB20 <- resStats_AB20[,c(1,4:7)]

# resStats_BC10 <- as.data.frame(read_csv("Results/PS results BC 10 yr age classes boot ras/resStats.csv"))
# studyArea <- rep("BC", each = nrow(resStats_BC10))
# ageClasses <- rep("10", each = nrow(resStats_BC10))
# resStats_BC10 <- cbind(resStats_BC10, studyArea, ageClasses)
# resStats_BC10[,4] <- NA
# resStats_BC10 <- resStats_BC10[,c(1,4:7)]

resStats_BC20 <- as.data.frame(read_csv("Results/PS results BC 20 yr age classes boot ras/resStats.csv"))
studyArea <- rep("BC", each = nrow(resStats_BC20))
ageClasses <- rep("20", each = nrow(resStats_BC20))
resStats_BC20 <- cbind(resStats_BC20, studyArea, ageClasses)
resStats_BC20 <- resStats_BC20[,c(1,4:7)]

resStats <- rbind( resStats_AB20,  resStats_BC20)
names(resStats)[names(resStats) == '...1'] <- 'birdSp'
resStats$ageClasses <- as.numeric(resStats$ageClasses)

autoCorStats <- gather(data=resStats, key="binningType", value="autocorStat", autocor1DRes, autocor2DRes, -studyArea, -ageClasses, -birdSp)
autoCorStats <- unite(autoCorStats, dataset, c(binningType, ageClasses), remove=FALSE)
autoCorStats <-na.omit(autoCorStats)

plotAutocorStats <- ggplot(data = autoCorStats,
                            aes(fill = factor(studyArea, levels=c("BC", "AB")), 
                                y= autocorStat, 
                                x= dataset)) + 
    geom_boxplot() +
    ggtitle("Spatial autocorrelation of mapped residuals, \nacross bird species") +
    #xlab()  +
    ylab("Moran's I \n") +
    scale_y_continuous(breaks= pretty_breaks()) +
    scale_x_discrete(labels=c("autocor1DRes_20" = "1D", "autocor2DRes_20" = "2D"))  + 
    theme_classic() + 
    scale_fill_manual(values=c("#009E73", "#56B4E9"), 
                      labels = c( "British Columbia", "Alberta")) +
    theme(title = element_text(size = 16),
          legend.title = element_blank(),
          legend.position= "bottom",
          legend.text = element_text(size =14),
          axis.text.x = element_text(size = 14), 
          axis.text.y = element_text(size = 12),
          axis.title.y = element_text(size = 14),
          axis.title.x = element_blank(),
          plot.margin = margin(0.5,0.5,0,0.5, "cm"),
           axis.line.y = element_line(linewidth = 1))

   plotAutocorStats

 #################################################################  
   dev.new()
   
     allMatrixPlot <- ggarrange(plotUnimodality +
                             theme(axis.text.x = element_blank(),
                                   axis.title.x = element_blank(),
                                   title = element_blank(),
                                   legend.position= "none")
                           ,
                           plotSpearmanStats +
                             theme(axis.text.x = element_blank(),
                                   axis.title.x = element_blank(),
                                   title = element_blank(),
                                   legend.position= "none")
                           ,
                           plotAutocorStats +
                             theme(title = element_blank())
                           ,
                           ncol = 1,
                           labels = c("A", "B", "C"),
                           label.args = list(gp=gpar(font=4, fontsize = 16), x=unit(1,"line"), hjust=1)
                            ) 

```

## RASTER VISUALISATION 


```{r plotExampleBirdRasters, echo=FALSE}



#for BC

bird <- "OVEN"

nmRas <- terra::rast(paste0("Results/PS results BC 20 yr age classes boot ras/", bird,"-meanBoot_60"))
mapRas <- terra::rast(paste0("Results/PS results BC 20 yr age classes boot ras/", bird, "-for2DAndNf1DMap"))
resRas <- terra::rast(paste0("Results/PS results BC 20 yr age classes boot ras/", bird, "-for2DAndNf1DRes"))

#ageRaster
min_ = min(min(terra::unique(nmRas)), min(terra::unique(mapRas)), min(terra::unique(resRas)))
max_ = max(max(terra::unique(nmRas)), max(terra::unique(mapRas)), max(terra::unique(resRas)))
r.range = c(min_, max_)
#colours <- colourRamp(colors = cbPalette, bias = 2)
layout(matrix(c(1,2,3), 2, 3, byrow = TRUE),
   widths=c(1,1,1.1), heights=c(1,3) )
#nmRasBC <- plot(nmRas, main = 'National Model', colNA="white", range = r.range, col = cbPalette, axes=FALSE, box=FALSE, breaks = c(-0.05, 0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15, 0.2, 0.25 )) 
#mapRasBC <- plot(mapRas, main = 'Mapped Predictions', colNA="white", range = r.range, col = cbPalette, axes=FALSE, box = FALSE,breaks = c(-0.05, 0, 0.025, 0.05, 0.075, 0.1, 0.125, 0.15, 0.2, 0.25 ))  
nmRasBC <- plot(nmRas, main = 'National Model', colNA="white", range = r.range, col = cbPalette, axes=FALSE, box=FALSE, legend = FALSE, cex.main = 1.5 ) 
mapRasBC <- plot(mapRas, main = 'Mapped Predictions', colNA="white", range = r.range, col = cbPalette, axes=FALSE, box = FALSE, legend = FALSE, cex.main = 1.5)
resRasBC <- plot(resRas, main = 'Residuals', colNA="white", range = r.range, col = cbPalette, axes=FALSE, box = FALSE, cex.main = 1.5, plg=list( cex = 1.25 # Legend text size
            ))


 
#for alberta

bird <- "OVEN"

nmRas <- terra::rast(paste0("Results/PS results AB 20 yr age classes boot ras/", bird,"-meanBoot_60"))
mapRas <- terra::rast(paste0("Results/PS results AB 20 yr age classes boot ras/", bird, "-for2DAndNf1DMap"))
resRas <- terra::rast(paste0("Results/PS results AB 20 yr age classes boot ras/", bird, "-for2DAndNf1DRes"))

#ageRaster
min_ = min(min(terra::unique(nmRas)), min(terra::unique(mapRas)), min(terra::unique(resRas)))
max_ = max(max(terra::unique(nmRas)), max(terra::unique(mapRas)), max(terra::unique(resRas)))
r.range = c(min_, max_)

layout(matrix(c(1,2,3), 2, 3, byrow = TRUE),
   widths=c(1,1,1.1), heights=c(1,3) )

plot(nmRas, main = 'National Model', colNA="white", range = r.range, col = cbPalette, axes=FALSE, box=FALSE, legend = FALSE, cex.main = 1.5 ) 
plot(mapRas, main = 'Mapped Predictions', colNA="white", range = r.range, col = cbPalette, axes=FALSE, box = FALSE, legend = FALSE, cex.main = 1.5)
plot(resRas, main = 'Residuals', colNA="white", range = r.range, col = cbPalette, axes=FALSE, box = FALSE, cex.main = 1.5, plg=list( cex = 1.25 # Legend text size
            ))

```